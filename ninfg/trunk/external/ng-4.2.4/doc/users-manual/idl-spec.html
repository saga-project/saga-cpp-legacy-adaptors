<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=us-ascii">
<title>Ninf-G IDL Specifications</title>
</head>
<body bgcolor=white>

<h2><a name="Ninf-G_IDL_Specifications">
6 Ninf-G IDL Specifications </a></h2>

<hr>
<ul>
<li><a href="#Ninf-G_IDL_keywords">
    6.1 Ninf-G IDL keywords </a>
<li><a href="#Ninf-G_IDL_syntax">
    6.2 Ninf-G IDL syntax </a>
<li><a href="#IDL_sample">
    6.3 IDL sample </a>
<li><a href="#Example_of_output_results">
    6.4 Example of output results </a>
</ul>
<hr>

<p>Ninf-G IDL files are processed by CPP(C Pre Processor).<br>
Please pay attention to CPP keywords(ex. "#include").</p>

<h3><a name="Ninf-G_IDL_keywords">
6.1 Ninf-G IDL keywords </a></h3>

<p>Keywords described below are reserved by Ninf-G.
You can't use these words as the name of module,
functions or parameters.</p>

<ul>
<li> <code>Module</code> module_name <code>;</code>

<p>This specifies the identifier of the Ninf-G Executable.
The name specified here is used for naming the Ninf-G stub file and the
makefile for compiling it, etc.</p>

<li> <code>Globals {</code> ... C descriptions ... <code>}</code>

<p>Global variables that can be
used from all of the remote functions and remote methods
that can be executed by the Ninf-G Executable can be defined.
The expression between braces ({ c }) is written in C.</p>

<p>Note: The maximum number of Globals which can be defined
in one IDL file is 100.</p>

<p>Note: The strings written in "Globals" are put to the Ninf-G stub file
which is generated by ng_gen as it is. So you can put CPP keywords
(like "#include &lt foo.h &gt") to the Ninf-G stub file by using "Globals". <br>
But if you want multiple of them, please use multiple "Globals" like
below.<br>
<br>
<code>
    Globals{#include &lt foo.h &gt} <br>
    Globals{#include &lt bar.h &gt} <br>
</code>
<br>
You can't write like below because Ninf-G IDL files are processed by CPP.<br>
<br>
<code>
    Globals{ <br>
      #include &lt foo.h &gt <br>
      #include &lt bar.h &gt <br>
    } <br>
</code>
</p>

<li> <code>Compiler "</code> ... <code>";</code>

<p>This specifies the compiler to
be used when the Ninf-G Executable is compiled.</p>

<li> <code>CompileOptions "</code> ... <code>";</code>

<p>This specifies the options to
be applied when the Ninf-G Executable is compiled.</p>

<p>Note: The maximum number of CompileOptions which can be
defined in one IDL file is 100.</p>

<li> <code>Linker "</code> ... <code>";</code>

<p>This specifies the linker to
be used at link time of Ninf-G Executable. 
</p>

<li> <code>Library "</code> ... <code>";</code>

<p>This specifies the libraries and the options
to be applied at the link time of Ninf-G Executable.</p>

<p>For example, ("-lxxx") and the object file (".o") or
library file (".a") will be specified in this section. 
The options specified in this section are applied only at link time
not at compile time (*.c -&gt; *.o).</p>

<p>Note: The maximum number of Library which can be
defined in one IDL file is 100.</p>

<li> <code>FortranFormat "</code>...<code>";</code>
     
<p>The Ninf-G stub is output as a C program.
When functions that are written in FORTRAN are called from that
program, the name must be converted to a particular format
(<code>"_%s_"</code>, where <code>%s</code> is a function name).
That conversion format is shown below.</p>

<p>The following character strings have special meanings;
they are replaced by particular character strings
at processing time.</p>

<p>
<ul>  
<li> <code>%s</code> : Original function name
<li> <code>%l</code> : All-uppercase function name
</ul>
</p>

<li><code>DefClass</code> class_name

<p>
[<code>"</code>description<code>"</code>]<br>
[<code>Required</code> <code>"</code>files-or-libs<code>"</code>]<br>
[<code>Backend</code> <code>"MPI"</code> | <code>"BLACS"</code>]<br>
[<code>Language</code>
    <code>"C"</code> | <code>"C++"</code> | <code>"FORTRAN"</code> ]<br>
[<code>Shrink</code> <code>"yes"</code> | <code>"no"</code>]<br>
<code>{</code>
[<code>DefState{</code> ... <code>}</code>]<br>
<code>DefMethod</code> method_name
<code>(</code> arg1, arg2, ... <code>)</code>
<code>{</code> ...<code>}</code><br>
... <code>}</code>
</p>

<p>Defines a remote class.</p>
<p>One <code>DefState</code> section and one or more remote methods
can be defined for the Ninf-G Executable.
The <code>DefState</code> section can be omitted.</p>

<p>The attribute values that can be
set are described below.</p>

<p>
<center>
<table border>
<tr>
<td> description </td>
<td> A character string that explains this Ninf-G Executable. </td>
</tr>
<tr><td></td>
<td>
Any character string may be used.
</td>
</tr>

<tr>
<td><code>Required</code></td>
<td> The remote function object file (".o"). </td>
</tr>
<tr><td></td>
<td>
This specifies the object file (".o") that stores the functions
used by the remote function.
</td>
</tr>

<tr>
<td><code>Backend</code></td>
<td> This specifies the backend at run time. </td>
</tr>
<tr><td></td>
<td>
<code>"MPI"</code> or <code>"BLACS"</code> can be specified.<br>
If omitted, no backend is used.
</td>
</tr>

<tr>
<td><code>Language</code></td>
<td> The programming language in which the remote method is written. </td>
</tr>
<tr><td></td>
<td>
<code>"C"</code>, <code>"C++"</code> or <code>"FORTRAN"</code>
can be specified.
If omitted, the default value is <code>"C"</code>.
</td>
</tr>

<tr>
<td><code>Shrink</code></td>
<td> Specify whether or not shrinking is enabled. </td>
</tr>
<tr><td></td>
<td>
If <code>"yes"</code> is specified, shrinking is applied
to the array elements.<br>
If omitted, shrinking is not done.
</td>
</tr>
</table>
</center>
</p>

<li> <code>DefState {</code> ... C descriptions ... <code>}</code>

<p>The variables maintained by Ninf-G Executable
are defined in C.</p>

<p>Those values can be shared by multiple remote methods of
the same Ninf-G Executable.</p>

<li> <code>DefMethod</code>

<p>
[<code>"</code>description<code>"</code>]<br>
[<code>CalcOrder</code> exp]<br>
{
<code>{</code> C descriptions <code>}</code>
| <code>Calls</code> lang-spec function_name
<code>(</code>arg1, arg2, ...<code>);</code>
}
</p>

<p>Defines a remote method.</p>

<p>A C program can be written in the remote method,
and functions can be called from within the program or
by using the <code>Calls</code> keyword to specify the
functions to be called.</p>

<p>Note: following keywords are reserved by Ninf-G.
So you can't use these keywords in your remote function.</p>
<ul>
<li> label : <code>"ng_stub_end"</code>, <code>"ng_stub_mpi_end"</code>
<li> variable : <code>"ng_stub_rank"</code>
</ul>

<p>The language in which the function that is called from
the remote method is written can be specified in the
lang-spec argument that comes right after the <code>Calls</code> keyword.
Currently, <code>"C"</code>, <code>"C++"</code> or <code>"FORTRAN"</code>
can be specified.
If omitted, the default <code>"C"</code> is used. <br>
If <code>"FORTRAN"</code> is specified here,
the called function must be converted to the format
specified by <code>FortranFormat</code> before it is called. 
</p>

<p>The attribute values that can be set are described below.</p>

<p>
<center>
<table border>
<tr>
<td> "description" </td>
<td> A character string that explains this remote method. </td>
</tr>
<tr><td></td>
<td>
Any character string can be used. 
</td>
</tr>

<tr>
<td><code>CalcOrder</code></td>
<td> Calculation order. </td>
</tr>
<tr><td></td>
<td>
The cost of executing the remote method can be specified
here in arbitrary expression form. 
</td>
</tr>
</table>
</center>
</p>

<ul>
<li> Special methods

<p>If argumentless remote methods are defined with the
following names, those remote methods will be executed
automatically when the Ninf-G Executable starts up and ends.</p>

<p>
<table border>
<tr>
<td><code>_initialize()</code></td>
<td> Executed at startup </td>
</tr>

<tr>
<td><code>_finalize()</code></td>
<td> Executed at end </td>
</tr>
</table>
</p>
</ul>

<li> <code>Define</code> function_name
<code>(</code> parameter1, parameter2, ... <code>)</code>

<p>
[<code>"</code>description<code>"</code>]<br>
[<code>Required</code> <code>"</code>files-or-libs<code>"</code>]<br>
[<code>CalcOrder</code> exp]<br>
[<code>Backend</code> <code>"MPI"</code> | <code>"BLACS"</code>]<br>
[<code>Language</code>
    <code>"C"</code> | <code>"C++"</code> | <code>"FORTRAN"</code>]<br>
[<code>Shrink</code> <code>"yes"</code> | <code>"no"</code>]<br>
{
<code>{</code> C descriptions <code>}</code>
| <code>Calls</code> lang-spec function_name
<code>(</code>arg1, arg2, ...<code>);</code>
} 
</p>

<p>Defines a remote function.</p>

<p>This remote function is a method that is exclusive
to the Ninf-G Executable.
A C program can be written in the remote function,
and functions can be called from within the program or
by using the <code>Calls</code> keyword to specify
the functions to be called.</p>

<p>Note: following keywords are reserved by Ninf-G.
So you can't use these keywords in your remote function.</p>
<ul>
<li> label : <code>"ng_stub_end"</code>, <code>"ng_stub_mpi_end"</code>
<li> variable : <code>"ng_stub_rank"</code>
</ul>

<p>The language in which the function that is called from
the remote method can be specified in the lang-spec argument
that comes right after the <code>Calls</code> keyword.
Currently, <code>"C"</code>, <code>"C++"</code> or <code>"FORTRAN"</code>
can be specified.</p>

<p>If omitted, the default <code>"C"</code> is used.
If <code>"FORTRAN"</code> is specified here,
the called function must be converted to the format
specified by <code>FortranFormat</code> before it is called.</p>

<p>The attribute values that can be set are described below.</p>

<p>
<center>
<table border>
<tr>
<td> "description" </td>
<td> A character string that explains this remote function. </td>
</tr>
<tr><td></td>
<td>
Any character string can be used.
</td>
</tr>

<tr>
<td><code>Required</code></td>
<td> The remote function object file (".o"). </td>
</tr>
<tr><td></td>
<td>
This specifies the object file (".o") that stores the functions
used by the remote function. 
</td>
</tr>

<tr>
<td><code>CalcOrder</code></td>
<td> Calculation order. </td>
</tr>
<tr><td></td>
<td>
The cost of executing the remote function can be specified here
in arbitrary expression form. 
</td>
</tr>

<tr>
<td><code>Backend</code></td>
<td> This specifies the backend at run time. </td>
</tr>
<tr><td></td>
<td>
<code>"MPI"</code> or <code>"BLACS"</code> can be specified.<br>
If omitted, no backend is used. 
</td>
</tr>

<tr>
<td><code>Language</code></td>
<td> The programming language in which the remote function is written. </td>
</tr>
<tr><td></td>
<td>
<code>"C"</code>, <code>"C++"</code> or <code>"FORTRAN"</code>
can be specified.<br>
If omitted, the default value is <code>"C"</code>. 
</td>
</tr>

<tr>
<td><code>Shrink</code></td>
<td> Specify whether or not shrinking is enabled. </td>
</tr>
<tr><td></td>
<td>
If <code>"yes"</code> is specified, shrinking is applied
to the array elements.<br>
If omitted, shrinking is not done. 
</td>
</tr>
</table>
</center>
</p>


<li> Parameters

<p>The arguments passed to the remote function
or remote method are written with the following syntax.</p>

<p>
[mode-spec] [type-spec] parameter_name [[dimension[:range]]+
</p>

<p>Note: A scalar variable cannot be used for the parameter
of callback function.</p>

<p>Note: The maximum number of the parameter which can be
defined as callback function is 32.</p>

<p>
<center>
<table border>
<tr>
<td> "mode-spec" </td>
<td> parameter mode </td>
</tr>
<tr><td></td>
<td>
<p>
<code>IN</code>, <code>OUT</code>, <code>INOUT</code> or
<code>WORK</code> can be specified.<br>
<code>"allocate"</code> and <code>"broadcast"</code> are
also available as modifiers for specifying a method for parameter
distribution in MPI and BLACS backends.<br>
<br>
&lt parameter mode &gt <br>
<code>IN</code> : Client -&gt; Server<br>
<code>OUT</code> : Server -&gt; Client<br>
<code>INOUT</code>: Both "IN" and "OUT" <br>
<code>WORK</code> : The values are not transmitted,
but an area is reserved on the server side.<br>
<br>
&lt parameter mode modifier &gt <br>
<code>allocate</code> : allocates a memory area for the variable
on every node whose rank is not 0.<br>
This specifier can be specified with all mode
("IN", "INOUT", "OUT", "WORK").<br>
<code>broadcast</code> : allocates a memory area for the variable
on every node whose rank is not 0. The value of the variable is broadcasted
from the rank0 node.<br>
This specifier can be specified with "IN" and "INOUT" mode.
</p>

<p>Note: The mode cannot be specified for Callback.
A scalar variable cannot be used for the parameter
that specifies the <code>OUT</code> mode.
</p>

<p>Note: "allocate" and "broadcast" can be written before or after
the mode keywords("IN", "INOUT", "OUT", "WORK"). If "allocate"
and "broadcast" are omitted, nothing will be done.
</p>

<p>Note: "allocate" and "broadcast" are ignored if the backend
of the remote method is neither "MPI" nor "BLACS".
</p>
</td>
</tr>

<tr>
<td> "type-spec" </td>
<td> Parameter type </td>
</tr>
<tr><td></td>
<td>
<p>
<code>char</code>, <code>short</code>, <code>int</code>,
<code>long</code>, <code>float</code>, <code>double</code>,
<code>string</code>, <code>scomplex</code>, <code>dcomplex</code>
or <code>filename</code> can be specified. <br>

The <code>char</code>, <code>short</code>, <code>int</code>,
<code>long</code>, <code>float</code> and <code>double</code>
terms correspond to the respective C types. 
</p>

<p>Note: The <code>string</code> term corresponds to
<code>char []</code>.
Callback does not specify the type.</p>

<p>Note: There is the example program for filename type
variable in Ninf-G package.
( &lt package directory &gt /diag/file_test )</p>
</td>
</tr>

<tr>
<td> parameter_name </td>
<td> any character string </td>
</tr>

<tr>
<td> Array specification </td>
<td> The specification of an array of parameters </td>
</tr>
<tr><td></td>
<td>
<p>If the parameter is an array,
it is written as "[" + expression + "]" and its size is specified.
A multidimensional array can be defined with
multiple "[" + expression + "]".</p>

<p>Also, the variables used by the argument
can be used in the expression.</p>

<p>It is also possible to specify the starting position,
ending position and shrinking interval within
"[" + expression + "]" as shown below to define arrays.</p>

<p>
"[" + expression (size) + ":" + expression (start position) + "]"<br>
"[" + expression (size) + ":" + expression (start position) + ","<br>
+ expression (ending position) + "]" <br>
"[" + expression (size) + ":" + expression (start position) + ","<br>
+ expression (ending position) + "," + expression (shrinking interval) + "]"<br>
</p>

<p>If a shrinking interval is specified and "Shrink" is enabled,
shrinking of variable values is done for transmission and saving.</p>

<p>Note: If "starting positon" is omitted,
then it's set to the value of "0".<br>

Note: If "ending positon" is omitted or it's specified "0",
then it's set to the value of "size".<br>

Note: If "shrinking interval" is omitted or it's specified "0",
then it's set to the value of "1".<br>

Note: Shrinking of string type variable is not supported.</p>
</td>
</tr>
</table>
</center>
</p>

<li> Expressions

<p>Expressions can be used to specify the calculation order
and the size of parameter arrays.</p>

<p>It can include constants, other <code>IN</code> mode
scalar parameter in the function definition, and some operators.
We provide some operators (<code>+</code>, <code>-</code>,
<code>*</code>, <code>/</code>, <code>%</code>...).
Priority among these operators is same as ANSI C.
You can also use parentheses in expressions.</p>

<p>Examples)</p>

<table border>
<tr>
<td><b> Arithmetic operations </b></td>
<td><code>10 / 2 * 5</code></td>
</tr>

<tr>
<td><b> Three term calculation </b></td>
<td><code>n % 10 ? 5: 2</code></td>
</tr>
</table>

</ul>

<h3><a name="Ninf-G_IDL_syntax">
6.2 Ninf-G IDL syntax </a></h3>

<pre>
<code>
/* program toplevel */
program:  /* empty */
      | declaration_list
    ;

declaration_list: 
        declaration
      | declaration_list declaration
    ;

declaration:
        "Module" IDENTIFIER ';'
      | "CompileOptions" STRING ';'
      | "Globals" globals_body
      | "Library" STRING ';'
      | "FortranFormat" STRING ';'
      | "FortranStringConvention" IDENTIFIER ';'
      | "Define" interface_definition opt_string option_list interface_body
      | "DefClass" IDENTIFIER opt_string defclass_option_list '{' define_list '}' 
      | "Compiler" STRING ';'
      | "Linker" STRING ';'
    ;

define_list:
        /* empty */
      | define_item
      | define_list define_item
    ;

define_item:
        "DefState" '{' 
      | "DefMethod" interface_definition opt_string
      defmethod_option_list interface_body
    ;

defmethod_option_list:
        /* empty */
      | defmethod_option
      | defmethod_option_list defmethod_option 
    ;

defmethod_option:
        calcorder
    ;

defclass_option_list:
        /* empty */
      | defclass_option
      | defclass_option_list defclass_option 
    ;

defclass_option:
        required
      | backend
      | shrink
      | language
    ;

option_list:
        /* empty */
      | decl_option
      | option_list decl_option 
    ;

decl_option:
        required
      | backend
      | shrink
      | calcorder
      | language
    ;

interface_definition: 
        IDENTIFIER '(' parameter_list ')'
      | IDENTIFIER '(' parameter_callback_list ')'
      | IDENTIFIER '(' callback_list ')'
    ;

callback_list:
        callback
      | callback_list ',' callback
    ;

parameter_callback_list:
        parameter_list ',' callback
      | parameter_callback_list ',' callback
    ;

parameter_list: 
        /* empty */ 
      | parameter
      | parameter_list ',' parameter
    ;

callback:
        IDENTIFIER '(' parameter_list ')'
    ;

parameter:
        decl_specifier declarator
    ;

decl_specifier: 
        mode_specifier type_specifier
      | type_specifier mode_specifier
      | type_specifier mode_specifier type_specifier
    ;

type_specifier:
        TYPE
      | TYPE TYPE
      | TYPE TYPE TYPE
    ;

mode_specifier:
        MODE
      | MODE DISTMODE
      | DISTMODE MODE
    ;

declarator:
        IDENTIFIER
      | '(' declarator ')'
      | declarator '['expr_or_null ']'
      | declarator '['expr_or_null ':' range_spec ']'
      | '*' declarator
    ;

range_spec:
        expr     /* upper limit */
      | expr ',' expr     /* lower limit and upper limit */
      | expr ',' expr ',' expr     /* lower, upper and step */
    ;

opt_string: 
        /* empty */
      | STRING 
    ;

required:
        "Required" STRING
    ;

backend:
        "Backend" STRING
    ;

shrink:
        "Shrink" STRING
    ;

language:
        "Language" STRING
    ;

calcorder:
        "CalcOrder" expr
    ;

interface_body:
    '{'  /* C statements */ '}'
    | "Calls" opt_string IDENTIFIER '(' id_list ')' ';'
    ;

globals_body:
    '{'  /* C statements */ '}'
    ;

id_list: IDENTIFIER
    | id_list ',' IDENTIFIER
    | /* empty */
    ;


/* index description */
expr_or_null: 
    expr 
    | /* empty */
    ;

expr:        
     unary_expr
    | expr '/' expr
    | expr '%' expr
    | expr '+' expr
    | expr '-' expr
    | expr '*' expr
    | expr '^' expr
    | expr '&lt;'  expr
    | expr "&lt;=" expr
    | expr "&gt;'  expr
    | expr "&gt;=" expr
    | expr "!=" expr
    | expr "==" expr
    | expr '?' expr ':' expr
    ;

unary_expr:
      primary_expr
    | '*' expr
    | '-' expr
    ;

primary_expr:
     primary_expr '[' expr ']'
    | IDENTIFIER
    | CONSTANT
    | '('  expr  ')'
    ;

/* TYPE = int, char, short, long, long float, double string scomplex dcomplex filename */
/* MODE = IN, OUT, INOUT, WORK */
/* DISTMODE = allocate broadcast */
/* IDENTIFIER = name */
/* CONSTANT = integer literals, floating point literals */
/* STRING = "..." */
</code>
</pre>


<h3><a name="IDL_sample">
6.3 IDL sample </a></h3>

<ul>
<li> Function version (one method only) 

<p><a href="idl-sample/function/sample.idl">
idl-sample/function/sample.idl</a></p>

<li> Object version (multiple methods) 
    
<p><a href="idl-sample/object/sample_obj.idl">
idl-sample/object/sample_obj.idl</a></p>

<li> samples from diagnostic program in Ninf-G package. 

<p>
<ul>
<li> <a href="idl-sample/diag/data_types.idl"> data types </a>
<li> <a href="idl-sample/diag/file_type.idl"> filename type </a>
<li> <a href="idl-sample/diag/callback.idl"> callback type </a>
<li> <a href="idl-sample/diag/skip.idl"> shrink arguments/results </a>
<li> <a href="idl-sample/diag/cancel.idl"> session cancel </a>
</ul>
</p>

<li> MPI sample 

<p>
<ul>
<li><a href="idl-sample/mpi/mpi.idl"> PI with MPI </a>
<p>"PI" is a sample program in Ninf-G package.</p>
<li><a href="idl-sample/mpi/mpi_test.idl"> data types test with MPI </a>
</ul>
</p>
 
<li> samples from users. 

<p>Followings are IDL files used by Ninf-G users.</p>
 
<ul>
<li><a href="idl-sample/users/users-sample1.idl"> users-sample1.idl</a>
<li><a href="idl-sample/users/users-sample2.idl"> users-sample2.idl</a>
<li><a href="idl-sample/users/users-sample3.idl"> users-sample3.idl</a>
<li><a href="idl-sample/users/users-sample4.idl"> users-sample4.idl</a>
</ul>

</ul>

<h3><a name="Example_of_output_results">
6.4 Example of output results </a></h3>

<ul>
<li> sample.idl processing results(IDL sample 1 from section 6.3)

<p>
<table>
<tr><td>
<a href="idl-sample/function/sample.mak">
idl-sample/function/sample.mak(Makefile)</a>
</td></tr>
    
<tr><td>
<a href="idl-sample/function/_stub_sin.c">
idl-sample/function/_stub_sin.c</a>
</td></tr>
    
<tr><td>
<a href="idl-sample/function/_stub_mmul.c">
idl-sample/function/_stub_mmul.c</a>
</td></tr>
    
<tr><td>
<a href="idl-sample/function/_stub_mmul2.c">
idl-sample/function/_stub_mmul2.c</a>
</td></tr>
    
<tr><td>
<a href="idl-sample/function/_stub_FFT.c">
idl-sample/function/_stub_FFT.c</a>
</td></tr>
</table>
</p>

<li> sample_obj.idl processing results (IDL sample 2 from section 6.3) 

<p>
<table>
<tr><td>
<a href="idl-sample/object/sample_object.mak">
idl-sample/object/sample_object.mak(Makefile)</a>
</td></tr>
    
<tr><td>
<a href="idl-sample/object/_stub_sample_object.c">
idl-sample/object/_stub_sample_object.c</a>
</td></tr>
</table>
</p>

</ul>

<hr>
last update : $Date: 2007/07/10 09:17:42 $
</body>
</html>

