<!--
  $RCSfile: external_module-develop.html,v $ $Revision: 1.8 $ $Date: 2008/03/28 02:18:25 $
  $AIST_Release: 5.0.0 $
  $AIST_Copyright:
   Copyright 2003, 2004, 2005, 2006 Grid Technology Research Center,
   National Institute of Advanced Industrial Science and Technology
   Copyright 2003, 2004, 2005, 2006 National Institute of Informatics
   
   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at
   
       http://www.apache.org/licenses/LICENSE-2.0
   
   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
   $
 -->

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=us-ascii">
<title>External Module Developer's Manual</title>
</head>
<body bgcolor=white>

<h2><a name="ExternalModule_develop">
External Module Developer's Manual</a></h2>

<p>This document describes how to develop a Ninf-G External Module.</p>

<hr>
<ul>
<li><a href="#Introduction">
    1. Introduction</a>

<li><a href="#ExternalModule">
    2. External Module</a>
<ul>
<li><a href="#ExternalModule_detail">
    2.1 Detailed overview of External Module</a>
<li><a href="#ExternalModule_protocol">
    2.2 Protocol of External Module</a>
<ul>
<li><a href="#ExternalModule_protocol_overview">
    2.2.1 Protocol Overview</a>
<li><a href="#ExternalModule_protocol_request">
    2.2.2 Request</a>
<li><a href="#ExternalModule_protocol_reply">
    2.2.3 Reply</a>
<li><a href="#ExternalModule_protocol_notify">
    2.2.4 Notify</a>
</ul>
</ul>

<li><a href="#InvokeServer">
    3. Invoke Server</a>
<ul>
<li><a href="#InvokeServer_Introduction">
    3.1 Introduction</a>

<ul>
<li><a href="#InvokeServer_Overview">
    3.1.1 Overview of a typical client application</a>
<li><a href="#InvokeServer_Requirements">
    3.1.2 Requirements for underlying middleware</a>
<li><a href="#InvokeServer_Implementation">
    3.1.3 Implementation Overview</a>
<li><a href="#InvokeServer_Execution">
    3.1.4 Execution flow</a>
</ul>

<li><a href="#InvokeServer_Specification">
    3.2 Specification of Invoke Server</a>

<ul>
<li><a href="#InvokeServer_Details">
    3.2.1 Details of Invoke Server</a>
<li><a href="#InvokeServer_Protocol">
    3.2.2 Protocol between a Ninf-G Client and Invoke Server</a>
<ul>
<li><a href="#InvokeServer_Protocol_Overview">
    3.2.2.1 Overview</a>
<li><a href="#InvokeServer_Protocol_Request">
    3.2.2.2 Request</a>
<li><a href="#InvokeServer_Protocol_Reply">
    3.2.2.3 Reply</a>
<li><a href="#InvokeServer_Protocol_Notify">
    3.2.2.4 Notify</a>
<li><a href="#InvokeServer_Protocol_JOB_CREATE_Request">
    3.2.2.5 <code>JOB_CREATE</code> Request</a>
</ul>
</ul>

<li><a href="#InvokeServer_How_to_specify">
    3.3 How to specify Invoke Server</a>
<ul>
<li><a href="#InvokeServer_How_to_specify_Invoke_Server">
    3.3.1 How to specify Invoke Server</a>
<li><a href="#InvokeServer_How_to_pass_information">
    3.3.2 How to pass information to Invoke Server</a>
<li><a href="#InvokeServer_Polling_interval">
    3.3.3 Polling interval</a>
<li><a href="#InvokeServer_Logfile">
    3.3.4 Logfile</a>
<li><a href="#InvokeServer_Maximum_number_of_jobs">
    3.3.5 Maximum number of jobs per Invoke Server</a>
<li><a href="#InvokeServer_path_of_the_Invoke_Server">
    3.3.6 How to specify the path of Invoke Server</a>
</ul>

<li><a href="#InvokeServer_Miscellaneous">
    3.4 Miscellaneous information</a>
<ul>
<li><a href="#InvokeServer_Job_Timeout">
    3.4.1 Job Timeout</a>
<li><a href="#InvokeServer_Redirect_stdout_stderr">
    3.4.2 Redirect stdout/stderr implemented using files</a>
</ul>
</ul>

<li><a href="#CommunicationProxy">
    4. Communication Proxy</a>
<ul>
<li><a href="#CommunicationProxy_Introduction">
    4.1 Introduction</a>

<ul>
<li><a href="#CommunicationProxy_Flow">
    4.1.1 Execution flow</a>
</ul>

<li><a href="#CommunicationProxy_Specification">
    4.2 Specification of Communication Proxy</a>
<ul>
<li><a href="#CommunicationProxy_Details">
    4.2.1 Details of Communication Proxy</a>
<li><a href="#CommunicationProxy_Protocol">
    4.2.2 Protocol between a Ninf-G Client (Ninf-G Executable)
        and Communication Proxy</a>
<ul>
<li><a href="#CommunicationProxy_Protocol_Overview">
    4.2.2.1 Overview</a>
<li><a href="#CommunicationProxy_Protocol_Request">
    4.2.2.2 Request</a>
<li><a href="#CommunicationProxy_Protocol_Reply">
    4.2.2.3 Reply</a>
<li><a href="#CommunicationProxy_Protocol_Notify">
    4.2.2.4 Notify</a>
</ul>
</ul>
</ul>

<li><a href="#InformationService">
    5. Information Service</a>
<ul>
<li><a href="#InformationService_Introduction">
    5.1 Introduction</a>

<li><a href="#InformationService_Specification">
    5.2 Specification of Information Service</a>
<ul>
<li><a href="#InformationService_Details">
    5.2.1 Details of Information Service</a>
<li><a href="#InformationService_Protocol">
    5.2.2 Protocol between a Ninf-G Client and Information Service</a>
<ul>
<li><a href="#InformationService_Protocol_Overview">
    5.2.2.1 Overview</a>
<li><a href="#InformationService_Protocol_Request">
    5.2.2.2 Request</a>
<li><a href="#InformationService_Protocol_Reply">
    5.2.2.3 Reply</a>
<li><a href="#InformationService_Protocol_Notify">
    5.2.2.4 Notify</a>
</ul>
</ul>
</ul>
</ul>

<hr>

<h3><a name="Introduction">
1. Introduction</a></h3>

<p>Ninf-G implements a function called "External Module." 
External Module abstracts the functions of Ninf-G and 
implements the function as a separate process. These functions include
(1) invocation of jobs (called "Invoke Server"), 
(2) communication between Ninf-G Client and Ninf-G Executable 
(called "Communication Proxy"), 
(3) Information services of Ninf-G Executable (called
"Information Service"). 
Implementation of these functions depends on the underlying grid middleware.
Abstracting the difference of the implementations, External Module
provides the same interface for Ninf-G.
In order to adopt a new
grid middleware, it is required to implement External Module by
the grid middleware.</p>

<p>Any user is able to implement an External Module to support a new
grid middleware.</p>

<h3><a name="ExternalModule">
2. External Module</a></h3>

<h4><a name="ExternalModule_detail">
2.1 Detailed overview of External Module</a></h4>

<p>Invoke Server, Communication Proxy, and Information Service are
External Modules. Some features are common for all External
Modules though each External Module has its own feature.</p>

<p>Common feature of External Module is as follows.</p>

<ul>
<li><p>External Module is invoked by Ninf-G Client or
Ninf-G Executable.</p>

<ul>
<li>Invoked by Ninf-G Client:
<p>Invoke Server, Client Communication Proxy, Information Service</p>

<li>Invoked by Ninf-G Executable:
<p>Remote Communication Proxy</p>
</ul>

<li><p>Invoke Server and Communication Proxy are External Modules both
of which is related with jobs. In these External Modules,
the maximum number of jobs per External Module can be limit 
by users. If the number of jobs exceeds the limit,
a new External Module is invoked.</p>

<li><p>Ninf-G Client (Ninf-G Executable) and External Module
communicate using three pipes which are created by the Ninf-G Client
(Ninf-G Executable) when the External Module is invoked. 
The details of External Module communication protocol is
described in <a href="#ExternalModule_protocol">Section 2.2</a>.</p>

<li><p>There are two types of finalization of External Module.
Ninf-G Client (1) do not wait or (2) wait, for the termination 
of External Module after the Ninf-G Client sends an EXIT 
request to the External Module.</p>

<li><p>External Module is implemented as a executable or script file 
which should be located in the <code>${NG_DIR}/bin</code> directory. 
It can be located in another directory if External Module is 
supplied with an absolute path to the executable file.</p>

<li><p>Ninf-G Client invokes several processes for the same type of
External Modules. For example, if the API
<code>grpc_config_file_read_np()</code> is called, a request for creating a
function/object handle or a information query is processed by
a newly invoked process.
Outstanding External Module is only used to handle
existing function/object handles.</p>

<li><p>Log file for External Module can be specified as an optional
argument of the External Module command.</p>

<p> Example:
<pre><code>
-l [Log file name]
</code></pre>
</p>

<p>If this option is specified, External Module outputs logs to the file
specified by this argument.  Otherwise, logs are not recorded.</p>

<li><p>External Module must not exit by unexpected 
optional argument of the command.</p>
</ul>

<h4><a name="ExternalModule_protocol">
2.2 Protocol of External Module</a></h4>

<h5><a name="ExternalModule_protocol_overview">
2.2.1 Protocol Overview</a></h5>

<p>A Ninf-G Client(Ninf-G Executable) and External Module exchange 
three types of messages: Request, Reply, and Notify. 
A Request message is sent from a Ninf-G Client(Ninf-G Executable) 
to External Module. Reply and Notify messages are sent from 
External Module to the Ninf-G Client(Ninf-G Executable). 
The Ninf-G Client(Ninf-G Executable) assumes that a Reply message 
must be returned from External Module when the Ninf-G Client 
(Ninf-G Executable) sends a Request message. 
A Notify message is used to send messages from External Module to 
the Ninf-G Client(Ninf-G Executable) asynchronously. 
Three different pipes are used for sending these three types of 
message.</p>

<p>
<center>
<table border>
<tr><th>Name</th><th>fd</th><th colspan=3>direction</th>
<tr><td>Request</td><td>stdin</td>
    <td rowspan=3>Ninf-G<br> Client<br> (Executable)</td>
    <td>----&gt;</td><td rowspan=3>External<br>Module</td></tr>
<tr><td>Reply</td><td>stdout</td>
    <td>&lt;----</td></tr>
<tr><td>Notify</td><td>stderr</td>
    <td> &lt;---- </td></tr>
</table>
</center>
</p>

<p>All messages are sent as plain text. 
The Return code (&lt;RET&gt;) is 0x0d0a. The Return code is 
a delimiter that determines the unit of messages.</p>

<h5><a name="ExternalModule_protocol_request">
2.2.2 Request</a></h5>

<p>Request have two types, one is described by one line and the other
one is described by multiple lines. Each request has respective
type.</p>

<p>In one line type request, parameters for the request is delimited
by space character, and the parameter cannot include space characters.
The request is expressed as follows:</p>

<pre><code>
&lt;Request Name&gt; &lt;Parameter&gt; &lt;Parameter&gt; ...&lt;RET&gt;
</code></pre>

<p>On multiple line type request, request name is on the first line. 
Following lines are expressed as attribute name, space character and 
attribute value. The attribute name cannot include space character. 
The end of the request is expressed as "request name _END." 
The request is expressed as follows:</p>

<pre><code>
&lt;Request Name&gt;&lt;RET&gt; 
&lt;Attribute Name&gt; &lt;Attribute Value&gt;&lt;RET&gt; 
&lt;Attribute Name&gt; &lt;Attribute Value&gt;&lt;RET&gt; 
... 
&lt;Request Name&gt;_END&lt;RET&gt; 
</code></pre>

<p>There is one common request on External Module. 
The <code>QUERY_FEATURES</code> request is prepared to query features 
implemented on the specific External Module. This request is 
issued just after the External Module process invocation. 
This request is a one line type request, and have no parameter.</p>

<h5><a name="ExternalModule_protocol_reply">
2.2.3 Reply</a></h5>

<p>Reply also has two types, one is described by one line and the
other one is described by multiple lines.  The each reply has
respective type.</p>

<p>In one line type reply, return success or failure as a parameter
followed by the return value.
On successful, "S" is returned followed by a return value.
On failure, "F" is returned followed by an error message.
The reply is expressed as follows:</p>

<pre><code>
S &lt;Return Value&gt; | F &lt;Error Message&gt;&lt;RET&gt;
</code></pre>

<p>On multiple line type reply, "SM" is returned on the first line. 
The failure cannot be expressed.
Following lines are expressed as attribute name, space character and 
attribute value. The attribute name cannot include space character. 
The end of the reply is expressed as "REPLY_END." 
The request is expressed as follows:</p>

<pre><code>
SM&lt;RET&gt; 
&lt;Attribute Name&gt; &lt;Attribute Value&gt;&lt;RET&gt; 
&lt;Attribute Name&gt; &lt;Attribute Value&gt;&lt;RET&gt; 
... 
REPLY_END&lt;RET&gt; 
</code></pre>

<p>The <code>QUERY_FEATURES</code> reply is a multiple line type reply.
On the reply, there are 3 type of information.
<code>"protocol_version"</code>, <code>"feature"</code>
and <code>"request"</code> are replied.</p>

<ul>
<li> protocol_version

<p>This specifies the protocol version of External Module.
Invoke Server, Communication Proxy, Information Service have
respective protocol version. This information can return
only one line.</p>

<li> feature
<p>This specifies the extended features that the External Module
implements.
One feature is on single line and multiple lines can be returned.</p>

<li> request
<p>This specifies all the requests, that the External Module
implements and is responsible.
One request is on single line, and multiple lines can be returned.</p>
</ul>


<h5><a name="ExternalModule_protocol_notify">
2.2.4 Notify</a></h5>

<p>Notify also has two types as same as Request.</p>

<p>In one line type request, the Notify is expressed as follows:</p>

<pre><code>
&lt;Notify Name&gt; &lt;Parameter&gt; &lt;Parameter&gt; ...&lt;RET&gt; 
</code></pre>

<p>In multiple line type request, the Notify is expressed as follows:</p>

<pre><code>
&lt;Notify Name&gt;&lt;RET&gt; 
&lt;Attribute Name&gt; &lt;Attribute Value&gt;&lt;RET&gt; 
&lt;Attribute Name&gt; &lt;Attribute Value&gt;&lt;RET&gt; 
... 
&lt;Notify Name&gt;_END&lt;RET&gt; 
</code></pre>

<h3><a name="InvokeServer">
3. Invoke Server</a></h3>

<h4><a name="InvokeServer_Introduction">
3.1 Introduction</a></h4>

<p>A Ninf-G Client invokes a Ninf-G Executable on the server machine
when a function requiring initialization of function/object handles,
such as grpc_function_handle_init(), is called.
Ninf-G, Version 2, implements the remote process invocation using
the Globus Toolkit's Pre-WS GRAM feature.
Implemented using the Globus API, the invocation mechanism has been
embedded in Ninf-G.
In order to utilize other systems, such as WS GRAM, UNICORE,
or Condor for remote process invocation, Ninf-G, Version 5,
implements the invocation mechanism as a separate module called
"Invoke Server."
This design enables users and developers to implement and add
a new Invoke Server that can utilize any job invocation mechanism.</p>


<p>Ninf-G Version 5.0.0 includes the following Invoke Servers:</p>

<ul>
<li>Invoke Server for WS GRAM, implemented in Python (GT4py)
<li>Invoke Server for Pre-WS GRAM, implemented in C (GT2c)
<li>Invoke Server for SSH, implemented in C (SSH)
<li>Invoke Server for Condor, implemented in Java (Condor)
<li>Invoke Server for NAREGI Super Scheduler, implemented in Java (NAREGISS)
<li>Invoke Server for WS GRAM, implemented in Java (GT4java)
<li>Invoke Server for UNICORE, implemented in Java (UNICORE)
</ul>

<h5><a name="InvokeServer_Overview">
3.1.1 Overview of a typical client application</a></h5>

<p>Here is a typical flow of a Ninf-G Client application:</p>

<ul>
<li>(1) grpc_initialize()

<p>Initializes data structures used by the Ninf-G Client.</p>

<li>(2) grpc_function_handle_init()

<p>Creates a function/object handle which requests remote process
invocation.
The request will be processed and a Ninf-G Executable
will be created on the server machine.
When the Ninf-G Executable is created,
it connects to the Ninf-G Client to establish a TCP connection
between the Ninf-G Executable and the Ninf-G Client.</p>

<li>(3) grpc_call() or grpc_call_async()/grpc_wait_any()

<p>Calls the remote function, i.e.
(3.1) the Ninf-G Client sends arguments to the Ninf-G Executable,
(3.2) the Ninf-G Executable performs some form of computation,
and (3.3) the Ninf-G Executable sends the results to the
Ninf-G Client.</p>


<li>(4) grpc_function_handle_destruct()

<p>Requests the Ninf-G Executable to terminate its process.
If an error occurs during the termination,
the Ninf-G Client requests the Invoke Server to kill
the Ninf-G Executable.</p>


<li>(5) grpc_finalize()

<p>Frees the data structures used by the Ninf-G Client.</p>
</ul>

<p>Invoke Server is required to implement initialization and
finalization of the function/object handles
which are described in steps (2) and (4).</p>


<h5><a name="InvokeServer_Requirements">
3.1.2 Requirements for underlying middleware</a></h5>

<p>The only requirement for underlying middleware is that
the middleware must be capable of remote process invocation.
Examples of such middleware include the Globus Toolkit Pre-WS GRAM,
Globus Toolkit WS GRAM, UNICORE, Condor, and SSH.</p>

<h5><a name="InvokeServer_Implementation">
3.1.3 Implementation overview</a></h5>

<p>Invoke Server is an adapter for the underlying middleware and it
handles requests from a Ninf-G Client.
Invoke Server analyzes and processes the request sent from
the Ninf-G Client and replies to the Ninf-G Client.
For example, if Invoke Server receives a <code>JOB_CREATE</code>
request from the Ninf-G Client, Invoke Server creates a Job ID,
returns the Job ID to the Ninf-G Client,
and invokes the job processes called for in the request.</p>

<p>Invoke Server can be implemented using any language.
The details of the protocol existing between the Ninf-G Client
and Invoke Server are described in
<a href="#InvokeServer_Specification"> Section 3.2</a></p>

<h5><a name="InvokeServer_Execution">
3.1.4 Execution flow</a></h5>

<p>This section describes a sample RPC flow to a server called serverA
via the Invoke Server, <code>IS_SAMPLE</code>.

<ul>
<li><b>(Prerequisite)</b>

<li><p>(1) A client configuration file that describes that
Invoke Server <code>IS_SAMPLE</code> is used for RPC to serverA
must be prepared.</p>

<li><b>(grpc_function_handle_init())</b>

<li><p>(2) The Ninf-G Client requests Invoke Server
<code>IS_SAMPLE</code> to create a
function/object handle.</p>

<li><p>(3) The first time <code>IS_SAMPLE</code> is required to create
a function/object handle, the <code>IS_SAMPLE</code> process is spawned by
the Ninf-G Client on the same machine.
<code>${NG_DIR}/bin/ng_invoke_server.IS_SAMPLE</code> is a command
for spawning an <code>IS_SAMPLE</code> process.</p>

<li><p>(4) The Ninf-G Client and <code>IS_SAMPLE</code>
communicate using three pipes (stdin, stdout, and stderr).
<code>QUERY_FEATURES</code> request and reply are performed at first.</p>

<li><p>(5) When grpc_function_handle_init() is called,
the Ninf-G Client sends <code>JOB_CREATE</code> request to
<code>IS_SAMPLE</code>,
followed by the required information
(e.g., the hostname and port number of the remote server),
and <code>JOB_CREATE_END</code>.</p>

<li><p>(6) When <code>IS_SAMPLE</code> receives
<code>JOB_CREATE</code> request,
<code>IS_SAMPLE</code> returns <code>"S"</code> to the Ninf-G Client,
which indicates that the request has been received by
the Invoke Server.</p>

<li><p>(7) <code>IS_SAMPLE</code> generates a new Job ID that corresponds
to the Request ID that was transferred with the <code>JOB_CREATE</code>
 request, and notifies the Job ID to the Ninf-G Client.
Then, <code>IS_SAMPLE</code> invokes the remote processes
(Ninf-G Executable) on serverA using its underlying middleware.</p>

<li><p>(8) The Ninf-G Client waits for the reply from
<code>IS_SAMPLE</code>,
and notify of Job ID.
When the Ninf-G Client receives the reply and Job ID,
it resumes the execution without waiting for actual job invocation
on serverA.</p>

<li><b>(grpc_call())</b>

<li><p>(9) When the Ninf-G Executable is invoked on serverA,
it connects to the Ninf-G Client using Globus IO.
The connection is used for communication
(e.g., argument transfers from the Ninf-G Client to the Ninf-G Executable)
between the Ninf-G Client and the Ninf-G Executable.
<code>IS_SAMPLE</code> does nothing for grpc_call().
If the underlying middleware for <code>IS_SAMPLE</code> returns an error
on remote process invocation, <code>IS_SAMPLE</code> must notify
the Ninf-G Client that the job invocation has failed.</p>


<li><b>(grpc_function_handle_destruct())</b>

<li><p>(10) When grpc_function_handle_destruct() is called,
the Ninf-G Client requests the Ninf-G Executable to exit the process.
This communication is carried out between the Ninf-G Client and
the Ninf-G Executable.
The Ninf-G Client does not wait for the Ninf-G Executables
to be terminated.</p>

<li><p>(11) When the Ninf-G Executable exits the process,
the job status managed by <code>IS_SAMPLE</code> should be changed to
<code>DONE</code>,
and <code>IS_SAMPLE</code> notifies the Ninf-G Client of the change
in job status to <code>DONE</code>.</p>

<li><p>(12) The Ninf-G Client sends a <code>JOB_DESTROY</code> request to
<code>IS_SAMPLE</code>.</p>

<li><p>(13) <code>IS_SAMPLE</code> returns <code>"S"</code> to
the Ninf-G Client when it receives the <code>JOB_DESTROY</code>
request.</p>

<li><p>(14) <code>IS_SAMPLE</code> returns <code>DONE</code> to
the Ninf-G Client
if the state of the corresponding job is <code>DONE</code>.
Otherwise, <code>IS_SAMPLE</code> cancels the job and notifies
the Ninf-G Client of the change in status to <code>DONE</code>
when the cancellation is completed and the status of
the job actually becomes <code>DONE</code>.</p>

<li><b>(grpc_finalize())</b>

<li><p>(15) When grpc_finalize() is called,
the Ninf-G Client sends an <code>EXIT</code> request to
<code>IS_SAMPLE</code>.</p>


<li><p>(16) <code>IS_SAMPLE</code> returns <code>"S"</code> to
the Ninf-G Client when it receives the <code>EXIT</code> request.
The pipes between <code>IS_SAMPLE</code> and Ninf-G Client
(stdin, stdout, stderr) are closed after it.</p>

<li><p>(17) <code>IS_SAMPLE</code> cancels all jobs and wait
the termination of all jobs, and exit.</p>

<li><p>(18) When the Ninf-G Client receives an <code>"S"</code> from
<code>IS_SAMPLE</code>,
it continues its execution, and does not wait for the termination
of all jobs.</p>
</ul>


<p>The following figure illustrates the interaction between
the Ninf-G Client, Invoke Server, and the Ninf-G Executable.</p>

<center>
<img src="figure/invoke_server-image.png"
    alt="Interaction of Invoke Server">
<p>Figure 1: Interaction between the Ninf-G Client,
Invoke Server and the Ninf-G Executable</p>
</center>


<h4><a name="InvokeServer_Specification">
3.2 Specification of Invoke Server</a></h4>

<p>This section describes a detailed overview of Invoke Server
and the protocol existing between a Ninf-G Client and Invoke Server.</p>


<h5><a name="InvokeServer_Details">
3.2.1 Details of Invoke Server</a></h5>

<ol>
<li><p>Invoke Server is invoked when a Ninf-G Client initializes a
function/object handle on the remote server which Ninf-G Client is
configured to use with the Invoke Server.</p>

<li><p>The maximum number of jobs per Invoke Server is limited.
If the number of jobs exceeds the limit,
a new Invoke Server is invoked.</p>

<li><p>Invoke Server exits the process if it receives an
<code>EXIT</code> request
from the Ninf-G Client.
This request is sent when the Ninf-G Client calls grpc_finalize().
Invoke Server also exits the process if it is managing the
maximum number of jobs and all jobs are terminated.</p>

<li><p>Ninf-G Client does not wait for the termination of Invoke Server
after the Ninf-G Client sends an <code>EXIT</code> request to
Invoke Server.</p>

<li><p>If the Ninf-G Client exits abnormally, the pipes will be
disconnected.
When Invoke Server detects that the pipes have been disconnected,
Invoke Server must cancel all jobs and exit the process.</p>

<li><p>The file names used with Invoke Server must follow the naming
convention of "ng_invoke_server" + suffix, where the suffix
corresponds to rules for the underlying middleware used for remote
process invocation.</p>
</ol>


<h5><a name="InvokeServer_Protocol">
3.2.2 Protocol between a Ninf-G Client and Invoke Server</a></h5>

<h6><a name="InvokeServer_Protocol_Overview">
3.2.2.1 Overview</a></h6>

<p>A common feature of External Module protocol is described in
<a href="#ExternalModule_protocol">Section 2.2</a>.
A protocol specific to Invoke Server is described
in the following sections.</p>


<h6><a name="InvokeServer_Protocol_Request">
3.2.2.2 Request</a></h6>

<p>Five Request messages,
<code>JOB_CREATE</code>, <code>JOB_STATUS</code>,
<code>JOB_DESTROY</code>, <code>EXIT</code>,
and <code>QUERY_FEATURES</code>
are supported.</p>

<ol>
<li><code>JOB_CREATE</code>

<ul>
<li>Format

<p>
<table border>
<tr><td>
<pre><code>
JOB_CREATE &lt;Request ID&gt;&lt;RET&gt;
hostname .....&lt;RET&gt;
port .....&lt;RET&gt;
... (snip)
JOB_CREATE_END&lt;RET&gt;
</code></pre>
</td></tr>
</table>
</p>

<li>Explanation
<p>This request is used to create and invoke a new job.
Required information for job invocation is described as a
set of attributes that is transferred along with
a <code>JOB_CREATE</code> request.
The details of these attributes are described in 
<a href="#InvokeServer_Protocol_JOB_CREATE_Request">Section 3.2.2.6</a>.
<code>JOB_CREATE</code> is the only request that is described
using multiple lines.
All the other requests can be described with a single line.</p>


<p>A Ninf-G Client transfers a Request ID to Invoke Server.
Invoke Server generates a unique Job ID and returns
it to the Ninf-G Client.
The Job ID is used by the Ninf-G Client to specify the job.</p>


<p>When Invoke Server receives a <code>JOB_CREATE</code> request,
it must send a Reply message to the Ninf-G Client.
Then, Invoke Server generates a unique Job ID and notifies
the Ninf-G Client of the Job ID.
Finally, Invoke Server requests job invocation on remote servers
via the underlying middleware used with the Invoke Server.</p>
</ul>


<li><code>JOB_STATUS</code>
<ul>
<li>Format

<p>
<table border>
<tr><td>
<pre><code>
JOB_STATUS &lt;Job ID&gt;&lt;RET&gt;
</code></pre>
</td></tr>
</table>
</p>

<li>Explanation
<p>This request queries Invoke Server on the status of jobs.
The current version of Ninf-G and prior does not use this
<code>JOB_STATUS</code> request.</p>
</ul>


<li><code>JOB_DESTROY</code>
<ul>
<li>Format

<p>
<table border>
<tr><td>
<pre><code>
JOB_DESTROY &lt;Job ID&gt;&lt;RET&gt;
</code></pre>
</td></tr>
</table>
</p>

<li>Explanation
<p>This request is used to terminate and destroy jobs.
Invoke Server cancels all jobs if it receives this request and
the corresponding jobs are not completed.
When Invoke Server confirms that all jobs are cancelled,
it sends <code>DONE</code> to the Ninf-G Client.</p>
</ul>


<li><code>EXIT</code>
<ul>
<li>Format

<p>
<table border>
<tr><td>
<pre><code>
EXIT&lt;RET&gt;
</code></pre>
</td></tr>
</table>
</p>

<li>Explanation
<p>This request is used to terminate Invoke Server.
If Invoke Server receives this <code>EXIT</code> request,
it must cancel all outstanding jobs and wait for their termination.</p>
</ul>
</ol>


<h6><a name="InvokeServer_Protocol_Reply">
3.2.2.3 Reply</a></h6>

<p>Invoke Server must send a Reply message to a Ninf-G Client
if Invoke Server receives a Request message from that Ninf-G Client.</p>

<ul>
<li><code>JOB_CREATE</code>, <code>JOB_DESTROY</code>, <code>EXIT</code>

<p>The reply to <code>JOB_CREATE</code>, <code>JOB_DESTROY</code>,
and <code>EXIT</code> messages is:</p>

<p>
<table border>
<tr><td>
<pre><code>
[S   | F &lt;Error String&gt;]&lt;RET&gt;
</code></pre>
</td></tr>
</table>
</p>

<p>where <code>S</code> is sent in case of Success.
Otherwise, <code>F</code> is returned, followed by
&lt;Error String&gt;.</p>

<li><code>JOB_STATUS</code>

<p>The reply to a <code>JOB_STATUS</code> request is:</p>

<p>
<table border>
<tr><td>
<pre><code>
[S &lt;Status&gt;  | F &lt;Error String&gt;]&lt;RET&gt;
</code></pre>
</td></tr>
</table>
</p>

<p>Where &lt;Status&gt; is denoted as: </p>
<pre><code>
&lt;Status&gt; : [PENDING | ACTIVE | DONE | FAILED]
</code></pre>

<p>Each status indication indicates the status such that:</p>

<p>
<ul>
<li><code>PENDING</code> : the Ninf-G Executable is waiting for invocation.
<li><code>ACTIVE</code> : the Ninf-G Executable is already invoked.
<li><code>DONE</code> : the Ninf-G Executable is already done.
<li><code>FAILED</code> : the Ninf-G Executable exited abnormally.
</ul>
</p>

<li><code>QUERY_FEATURES</code>

<p>The reply to a <code>QUERY_FEATURES</code> request is
described in <a href="#ExternalModule_protocol_reply"> 2.2.3</a>.
Ninf-G Version 5.0.0 Invoke Server has protocol version 2.0.</p>

<p>Following features can be returned.</p>

<ul>
<li><code>STAGING_AUTH_NUMBER</code>
<p>If the Invoke Server implements the staging of 
Simple Auth Number by file, this feature must be returned.</p>

<li><code>STAGING_COMMUNICATION_PROXY</code>
<p>If the Invoke Server implements the staging of
Remote Communication Proxy, this feature must be returned.</p>
</ul>
</ul>

<h6><a name="InvokeServer_Protocol_Notify">
3.2.2.4 Notify</a></h6>

<p>A Notify message is used to send an asynchronous message from
Invoke Server to a Ninf-G Client.
Two types of Notify message are provided.</p>

<ol>
<li><code>CREATE_NOTIFY</code>
<ul>
<li>Format

<p>
<table border>
<tr><td>
<pre><code>
CREATE_NOTIFY &lt;Request ID&gt; [S &lt;Job ID&gt; | F &lt;Error String&gt;]&lt;RET&gt;
</code></pre>
</td></tr>
</table>
</p>

<li>Explanation
<p>This is used to notify the Ninf-G Client of the Job ID.  A Job ID is
case sensitive and cannot include invisible characters.</p>
</ul>


<li><code>STATS_NOTIFY</code>
<ul>
<li>Format

<p>
<table border>
<tr><td>
<pre><code>
STATUS_NOTIFY &lt;Job ID&gt; &lt;Status&gt; &lt;String&gt;&lt;RET&gt;
</code></pre>
</td></tr>
</table>
</p>

<pre><code>
&lt;Status&gt; : [PENDING | ACTIVE | DONE | FAILED]
</code></pre>


<li>Explanation

<p>This message is used to send notification that the status of a job has
been changed.</p>

<p>&lt;String&gt; can be any string,
and the &lt;String&gt; is stored in an output log.
It should be noted that the status of job can be changed from
<code>PENDING</code> to <code>DONE</code>.</p>
</ul>
</ol>


<h6><a name="InvokeServer_Protocol_JOB_CREATE_Request">
3.2.2.6 <code>JOB_CREATE</code> Request</a></h6>

<p>This section describes the details of
a <code>JOB_CREATE</code> Request.</p>

<ul>
<li>Format

<p>
<table border>
<tr><td>
<pre><code>
JOB_CREATE &lt;Request ID&gt;&lt;RET&gt;
hostname .....&lt;RET&gt;
port .....&lt;RET&gt;
... (snip)
JOB_CREATE_END&lt;RET&gt;
</code></pre>
</td></tr>
</table>
</p>

<p>Attributes are placed between <code>JOB_CREATE&lt;RET&gt;</code>
and <code>JOB_CREATE_END&lt;RET&gt;</code>.
Only one attribute can occupy one line and one line must
include one and only one attribute.
Attributes can be placed in any order.
There are two types of attributes, mandatory attributes and
optional attributes.  Invoke Server must return an error
if mandatory attributes are not included.
Any unknown optional attributes must be ignored.</p>

<li>Attributes

<p>The following is a list of attributes supported by Ninf-G.
Some of these attributes are provided for the Globus Toolkit's
Pre-WS GRAM and WS-GRAM.
Any new attribute can be defined using the
Client configuration file &lt;SERVER&gt; section
<code>"invoke_server_option"</code> attribute.</p>

<p>
<table border>
<tr>
<th> name </th>
<th> mandatory </th>
<th> meanings </th>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-hostname">
     hostname </a></td>
<td> yes </td>
<td> Host name of the server </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-port">
     port </a></td>
<td> yes </td>
<td> Port number </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-jobmanager">
     jobmanager </a></td>
<td> no </td>
<td> Job Manager </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-subject">
     subject </a></td>
<td> no </td>
<td> Subject of the GRAM </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-client_name">
     client_name </a></td>
<td> yes </td>
<td> Host name of the Ninf-G Client </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-executable_path">
     executable_path </a></td>
<td> yes </td>
<td> Path of the Ninf-G Executable </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-backend">
     backend </a></td>
<td> yes </td>
<td> Backend of the remote function (e.g., MPI) </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-count">
     count </a></td>
<td> yes </td>
<td> Number of Ninf-G Executables </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-staging">
     staging </a></td>
<td> yes </td>
<td> A flag indicating if staging is used or not </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-auth_number">
     auth_number </a></td>
<td> no </td>
<td> Simple Auth Number </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-argument">
     argument </a></td>
<td> yes </td>
<td> Arguments for the Ninf-G Executable </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-work_directory">
     work_directory </a></td>
<td> no </td>
<td> Working directory of the remote function </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-tmp_dir">
     tmp_dir </a></td>
<td> no </td>
<td> temporary files directory </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-redirect_enable">
     redirect_enable </a></td>
<td> yes </td>
<td> A flag indicating redirection of stdout/stderr </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-stdout_file">
     stdout_file </a></td>
<td> no </td>
<td> file name of stdout </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-stderr_file">
     stderr_file </a></td>
<td> no </td>
<td> file name of stderr </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-communication_proxy_staging">
     communication_proxy_staging </a></td>
<td> no </td>
<td> stage the Communication Proxy or not </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-communication_proxy_path">
     communication_proxy_path </a></td>
<td> no </td>
<td> path of the Communication Proxy </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-environment">
     environment </a></td>
<td> no </td>
<td> Environment variables </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-status_polling">
     status_polling </a></td>
<td> yes </td>
<td> Interval of status polling </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-refresh_credential">
     refresh_credential </a></td>
<td> yes </td>
<td> Interval of credential refresh </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-max_time">
     max_time </a></td>
<td> no </td>
<td> Maximum execution time </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-max_wall_time">
     max_wall_time </a></td>
<td> no </td>
<td> Maximum wall clock time </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-max_cpu_time">
     max_cpu_time </a></td>
<td> no </td>
<td> Maximum CPU time </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-queue_name">
     queue_name </a></td>
<td> no </td>
<td> Name of the queue </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-project">
     project </a></td>
<td> no </td>
<td> Name of the project </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-host_count">
     host_count </a></td>
<td> no </td>
<td> Number of executables per host </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-min_memory">
     min_memory </a></td>
<td> no </td>
<td> Minimum size of requested memory </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-max_memory">
     max_memory </a></td>
<td> no </td>
<td> Maximum size of requested memory </td>
</tr>

<tr>
<td> <a href="#InvokeServer_attribute-rsl_extensions">
     rsl_extensions </a></td>
<td> no </td>
<td> RSL extension </td>
</tr>

</table>
</p>

<p>Detailed description</p>

<ul>
<li><a name="InvokeServer_attribute-hostname">
  hostname [hostname]</a>

<p>Host name of the server machine.</p>


<li><a name="InvokeServer_attribute-port">
  port [number]</a>

<p>The server port number on which the server is listening.
The default value is depend on underlying middleware.</p>


<li><a name="InvokeServer_attribute-jobmanager">
  jobmanager [jobmanager name]</a>

<p>The job manager used on the server machine.</p>


<li><a name="InvokeServer_attribute-subject">
  subject [subject] </a>

<p>The certificate subject of the resource manager contact.</p>


<li><a name="InvokeServer_attribute-client_name">
  client_name [client name] </a>

<p>The host name of the client machine.</p>


<li><a name="InvokeServer_attribute-executable_path">
  executable_path [path to the executable] </a>

<p>Absolute path of the Ninf-G Executable.
The path represents a remote path if staging is off.
Otherwise, the path represents a local path.</p>


<li><a name="InvokeServer_attribute-backend">
  backend [backend] </a>

<p>The method for launching the Ninf-G Executable is specified as
backend.
The value is <code>NORMAL</code>,
<code>MPI</code>, or <code>BLACS</code>.
If <code>MPI</code> or <code>BLACS</code> is specified,
the Ninf-G Executable must be invoked via the mpirun command.</p>


<li><a name="InvokeServer_attribute-count">
  count [number] </a>

<p>The number of Ninf-G Executables to be invoked.
If the backend is <code>MPI</code> or <code>BLACS</code>,
count means the number of nodes.</p>


<li><a name="InvokeServer_attribute-staging">
  staging [true/false] </a>

<p>The value is true if staging is on and Invoke Server must transfer
the Ninf-G Executable file from the local machine to the remote
machine.</p>


<li><a name="InvokeServer_attribute-auth_number">
  auth_number [number] </a>

<p>The value to be used as a simple auth number of Ninf-G.
The Invoke Server must write this number to file and stage to
the server.</p>

<p>In addition, the Invoke Server must add the
"--authNumberFile=[remote auth number file]" argument
to the Ninf-G Executable to tell the Simple Auth Number.</p>

<p>If this attribute can be treated, the Invoke Server
must tell the Ninf-G Client by sending feature
<code>STAGING_AUTH_NUMBER</code> on
<code>QUERY_FEATURES</code> request's reply.</p>


<li><a name="InvokeServer_attribute-argument">
  argument [argument] </a>

<p>An argument for the Ninf-G Executable is specified
using this attribute.
This attribute can specify one argument only,
and multiple arguments must be specified one by one,
by using this attribute for each one.
The arguments must be passed to the Ninf-G Executable as arguments.</p>

<p>
Example:
<pre><code>
argument --connectbackAddress=...
argument --authNumber=...
argument --contextID=...
</code></pre>
</p>


<li><a name="InvokeServer_attribute-work_directory">
  work_directory [directory] </a>

<p>This attribute specifies the directory in which the Ninf-G
Executable is invoked.</p>


<li><a name="InvokeServer_attribute-tmp_dir">
     tmp_dir [directory] </a>

<p>The directory in which temporal files are placed.</p>


<li><a name="InvokeServer_attribute-redirect_enable">
  redirect_enable [true/false] </a>

<p>This attribute is set to true if the stdout/stderr of the Ninf-G
Executable has been requested to be transferred to the Ninf-G
Client.</p>


<li><a name="InvokeServer_attribute-stdout_file">
  stdout_file [filename] </a>

<p>If redirect_enable is set to true,
this attribute specifies the name of the output file for stdout.
Invoke Server must output the stdout to this file.
The Ninf-G Client reads this file as an output file
and writes the contents of the file to the stdout of the Ninf-G
Client.</p>


<li><a name="InvokeServer_attribute-stderr_file">
  stderr_file [filename] </a>

<p>If redirect_enable is set to true,
this attribute specifies the name of the output file of the stderr.
Invoke Server must output the stderr to this file.
The Ninf-G Client reads this file as an output file
and writes the contents of the file to the stderr of the Ninf-G
Client.</p>


<li><a name="InvokeServer_attribute-communication_proxy_staging">
  communication_proxy_staging [true/false] </a>

<p>The value is true if the staging of Remote Communication Proxy is
enabled and Invoke Server must transfer the Remote Communication Proxy
file from the local machine to the server machine.
Staged executable file path on the server machine must be
passed to Ninf-G Executable by
<code>--communicationProxyPath</code> argument.
This argument must be added by the Invoke Server.</p>

<p>Otherwise, staging of Remote Communication Proxy is not
performed.</p>

<p>If this attribute can be treated, the Invoke Server
must tell the Ninf-G Client by sending feature
<code>STAGING_COMMUNICATION_PROXY</code> on
<code>QUERY_FEATURES</code> Reply.</p>


<li><a name="InvokeServer_attribute-communication_proxy_path">
  communication_proxy_path [path] </a>

<p>This attribute specifies the staged executable file path of
Remote Communication Proxy on the local machine.
Invoke Server must stage the file
specified by this attribute if the staging of 
Remote Communication Proxy is set to true.</p>


<li><a name="InvokeServer_attribute-environment">
  environment [ENV=VALUE] </a>

<p>The environment variable for the Ninf-G Executable
is passed using this attribute.
The environment variable and its value are connected by <code>=</code>.
Only the variable is specified if it does not take a value.
Multiple environment variables must be specified one by one.</p>


<li><a name="InvokeServer_attribute-status_polling">
  status_polling [interval] </a>

<p>Invoke Server may need to check the status of jobs by polling the
status of existing jobs.
This attribute specifies the interval of the polling.
The value is in seconds, and if it is not specified,
the default value 0 is passed.</p>


<li><a name="InvokeServer_attribute-refresh_credential">
  refresh_credential [interval] </a>

<p>This attribute specifies the interval for refreshing credentials.
The value is in seconds, and if it is not specified, the default
value 0 is passed.</p>


<li><a name="InvokeServer_attribute-max_time">
  max_time [time] </a>

<p>This attribute specifies the maximum time of the job.</p>


<li><a name="InvokeServer_attribute-max_wall_time">
  max_wall_time [time] </a>

<p>This attributes specifies the maximum wall clock time of the job.</p>


<li><a name="InvokeServer_attribute-max_cpu_time">
  max_cpu_time [time] </a>

<p>This attribute specifies the maximum cpu time of the job.</p>


<li><a name="InvokeServer_attribute-queue_name">
  queue_name [queue] </a>

<p>This attribute specifies the name of the queue to which the Ninf-G
Executable should be submitted.</p>


<li><a name="InvokeServer_attribute-project">
  project [projectname] </a>

<p>This attribute specifies the name of the project.</p>


<li><a name="InvokeServer_attribute-host_count">
  host_count [number of nodes] </a>

<p>This attribute specifies the number of nodes.</p>


<li><a name="InvokeServer_attribute-min_memory">
  min_memory [memory size (MB)] </a>


<p>This attribute specifies the minimum requirements
for the memory size of the job.</p>


<li><a name="InvokeServer_attribute-max_memory">
  max_memory [memory size (MB)] </a>

<p>This attribute specifies the maximum memory size of the job.</p>

<li><a name="InvokeServer_attribute-rsl_extensions">
  rsl_extensions [RSL extension] </a>

<p>This attribute can be used to specify the RSL extension which is
available for the Globus Toolkit's WS GRAM.</p>

</ul>
</ul>


<h4><a name="InvokeServer_How_to_specify">
3.3 How to specify Invoke Server</a></h4>


Invoke Server is specified by the Ninf-G Client using a Client
configuration file.

<h5><a name="InvokeServer_How_to_specify_Invoke_Server">
3.3.1 How to specify Invoke Server</a></h5>

<p>Invoke Server is specified by using the invoke_server attribute in the
&lt;SERVER&gt; section.</p>

<p>
<pre><code>
invoke_server [type]
</code></pre>
</p>

<p>Type specifies the type of the Invoke Server,
such as GT4py or UNICORE.</p>

<h5><a name="InvokeServer_How_to_pass_information">
3.3.2 How to pass information to Invoke Server</a></h5>

<p>Invoke Server may require options for its execution.
Such options can be specified by an option attribute
in the &lt;INVOKE_SERVER&gt; section or
by an invoke_server_option attribute in the &lt;SERVER&gt; section.

<p>
<pre><code>
option [String]
invoke_server_option [String]
</code></pre>
</p>

<p>Multiple attributes can be specified in the &lt;SERVER&gt; or
&lt;INVOKE_SERVER&gt; sections.</p>


<h5><a name="InvokeServer_Polling_interval">
3.3.3 Polling interval</a></h5>

<p>Invoke Server must check the status of jobs,
and this may be implemented using polling.
The polling interval can be specified by the
status_polling attribute in the &lt;INVOKE_SERVER&gt; section.

<p>
<pre><code>
status_polling [interval (seconds)]
</code></pre>
</p>

<h5><a name="InvokeServer_Logfile">
3.3.4 Logfile</a></h5>

<p>The filename of the Invoke Server's execution log
can be specified by the invoke_server_log attribute
in the &lt;CLIENT&gt; section.

<p>
<pre><code>
invoke_server_log [filename]
</code></pre>
</p>

<p>If this attribute is specified,
Invoke Server outputs logs to a file with
the specified filename and file type of that Invoke Server.</p>

<p>The log_filePath attribute in the &lt;INVOKE_SERVER&gt; section
can be used to specify a log file for a specific Invoke Server.</p>

<p>
<pre><code>
log_filePath [Log file name]
</code></pre>
</p>


<h5><a name="InvokeServer_Maximum_number_of_jobs">
3.3.5 Maximum number of jobs per Invoke Server</a></h5>

<p>The maximum number of jobs per Invoke Server can be limited
by the max_jobs attribute in the &lt;INVOKE_SERVER&gt; section.
If the number of requested jobs exceeds this value,
the Ninf-G Client invokes a new Invoke Server
and requests that Invoke Server to manage the new jobs.</p>

<p>
<pre><code>
max_jobs [maximum number of jobs]
</code></pre>
</p>

<h5><a name="InvokeServer_path_of_the_Invoke_Server">
3.3.6 How to specify the path of Invoke Server</a></h5>

<p>If Invoke Server is not located in a pre-defined directory,
the path attribute in &lt;INVOKE_SERVER&gt; can be used to
specify the path of the Invoke Server.</p>

<p>
<pre><code>
path [path of the Invoke Server]
</code></pre>
</p>


<h4><a name="InvokeServer_Miscellaneous">
3.4 Miscellaneous Information</a></h4>


<h5><a name="InvokeServer_Job_Timeout">
3.4.1 Job Timeout</a></h5>

<p>The Job Timeout function is managed by the Ninf-G Client.
Invoke Server is not responsible for the timeout.</p>

<h5><a name="InvokeServer_Redirect_stdout_stderr">
3.4.2 Redirect stdout/stderr implemented using files</a></h5>

<p>Redirect stdout/stderr is implemented using files.</p>

<ul>
<li>The Ninf-G Client passes the filename to Invoke Server as an
attribute for the <code>JOB_CREATE</code> request.

<li>Invoke Server outputs the stdout/stderr of
the Ninf-G Executable to the file.

<li>The Ninf-G Client outputs the contents of the file
to the stdout/stderr.
</ul>

<h3><a name="CommunicationProxy">
4. Communication Proxy</a></h3>

<h4><a name="CommunicationProxy_Introduction">
4.1 Introduction</a></h4>

<p>Communication Proxy mediates communications between
Ninf-G Executable and Ninf-G Client.</p>

<p>Ninf-G Client communicates with Ninf-G Executables.
At this time, if Communication Proxy is not used, direct TCP/IP 
connection from the Ninf-G Executable to the Ninf-G Client is
performed.</p>

<p>If the Communication Proxy is used, following connection is
performed.</p>

<ol>
<li>
<p>Ninf-G Executable invokes the Remote Communication Proxy and 
connects to it.</p>

<li>
<p>Remote Communication Proxy connects to
the Client Communication Proxy.</p> 

<li>
<p>Client Communication Proxy connects to the Ninf-G Client.</p>
</ol>

<p>About connection of 2., any the communication method and Grid Middleware
can be used to implement a Communication Proxy.</p>

<p>In communications between Ninf-G Client and
Client Communication Proxy, and in communications between
Ninf-G Executable and Remote Communication Proxy,
a socket is used as Ninf-G protocol while the External Module protocol
(request, reply and notify) is communicated with three pipes.</p>

<p>Ninf-G Version 5.0.0 includes the following Communication Proxy:</p>
 
<ul>
<li> Communication Proxy for Globus Toolkit XIO, implemented in C (GT) 
</ul>

<h5><a name="CommunicationProxy_Flow">
4.1.1 Execution flow</a></h5>

<p>Following is the flow of connection from Ninf-G Executable to
Ninf-G Client via Communication Proxy.</p>

<ol>
<li><p>If the Client Communication Proxy is not invoked,
Ninf-G Client invokes the Client Communication Proxy and sends
<code>INITIALIZE</code> Request to the Client Communication Proxy.</p>

<li><p>The Client Communication Proxy receives <code>INITIALIZE</code>
Request and initializes itself. Then returns <code>INITIALIZE</code>
Reply to the Ninf-G Client.</p>

<li><p>The Ninf-G Client sends <code>PREPARE_COMMUNICATION</code>
Request, before requesting Invoke Server to invoke job related to
function/object handle.</p>

<li><p>The Client Communication Proxy returns the Reply,
and prepares communication.</p>

<li><p>The Client Communication Proxy sends
<code>COMMUNICATION_REPLY</code> Notify to Ninf-G Client after the
preparation of the communication is completed.
At this time, <code>COMMUNICATION_REPLY</code> attributes sent to
Ninf-G Client includes the information to connect to
the Client Communication Proxy(We note "CCP connect info" here).</p>

<li><p>The Ninf-G Client requests to the Invoke Server to invoke
a Ninf-G Executable on the server. "CCP connect info" is also send
to the Invoke Server.</p>

<li><p>By the Invoke Server, a Ninf-G Executable on the server is
invoked. The Ninf-G Executable invokes a Remote Communication Proxy.</p>

<li><p>The Ninf-G Executable sends <code>INITIALIZE</code> Request
to the Remote Communication Proxy with "CCP connect info."</p>

<li><p>The Ninf-G Executable waits the 
<code>INITIALIZE</code> Reply from the Remote Communication Proxy.</p>

<li><p>The Remote Communication Proxy prepares the connection from
the Ninf-G Executable, and the address information to connect to the
Remote Communication Proxy is returned to the Ninf-G Executable
by <code>INITIALIZE</code> Reply.</p>

<li><p>The Ninf-G Executable connects to the address which was returned
from the Remote Communication Proxy.</p>

<li><p>The Remote Communication Proxy connects to the address
which is described in "CCP connect info", by respective way of
Communication Proxy defines.</p>
</ol>


<h4><a name="CommunicationProxy_Specification">
4.2 Specification of Communication Proxy</a></h4>

<h5><a name="CommunicationProxy_Details">
4.2.1 Details of Communication Proxy</a></h5>

<ul>
<li><p>Client Communication Proxy and Remote Communication Proxy is
invoked when a Ninf-G Client initializes a function/object
handle on the remote server which Ninf-G Client is configured to use
with the Communication Proxy.</p>

<li><p>The maximum number of jobs per Client Communication Proxy is
limited. If the number of jobs exceeds the limit,
a new Client Communication Proxy is invoked.
There may have several connections on one job.</p>

<li><p>Remote Communication Proxy exits when the Ninf-G Executable
is exiting.</p>

<li><p>Ninf-G Client (Ninf-G Executable) waits the termination of
Communication Proxy after the Ninf-G Client sends an EXIT request
to Communication Proxy.</p>

<li><p>The file names used with Communication Proxy must follow the naming
convention of "ng_client_communication_proxy" + suffix
for Client Communication Proxy,
"ng_remote_communication_proxy" + suffix for Remote Communication Proxy
, where the suffix corresponds to rules for the underlying middleware
used for communication.</p>
</ul>

<h5><a name="CommunicationProxy_Protocol">
4.2.2 Protocol between a Ninf-G Client (Ninf-G Executable) and
    Communication Proxy</a></h5>

<h6><a name="CommunicationProxy_Protocol_Overview">
4.2.2.1 Overview</a></h6>

<p>A common feature of External Module protocol is described in
<a href="#ExternalModule_protocol">Section 2.2</a>.
A protocol specific to Communication Proxy is described
in the following sections.</p>


<h6><a name="CommunicationProxy_Protocol_Request">
4.2.2.2 Request</a></h6>

<p>Four Request messages, <code>INITIALIZE</code>,
<code>PREPARE_COMMUNICATION</code>, 
<code>EXIT</code> and <code>QUERY_FEATURES</code> are supported.</p>

<ol>
<li><code>INITIALIZE</code>

<ul>
<li>Format

<p>
<table border>
<tr><td>
<pre><code>
INITIALIZE&lt;RET&gt;
listen_port ...&lt;RET&gt;
buffer_size ...&lt;RET&gt;
... (snip) 
INITIALIZE_END&lt;RET&gt;
</code></pre>
</td></tr>
</table>
</p>

<li>Explanation

<p>This request is used to initialize the Communication Proxy after 
the invocation. Ninf-G Client and Ninf-G Executable send
this request to Communication Proxy only once. 
<code>INITIALIZE</code> request after the first time
<code>INITIALIZE</code> causes a failure. 
This request allows to take time to initialize and not return 
immediately. 
This request is a multiple line type request.</p>

<p><code>INITIALIZE</code> request attributes are different between 
Client Communication Proxy and Remote Communication Proxy.</p>

<ul>
<li>Client Communication Proxy

<p>Following attributes are passed from Ninf-G Client.</p>

<p>Any attributes not shown in the following table can be specified 
by specifying Ninf-G Client configuration file 
&lt;CLIENT_COMMUNICATION_PROXY&gt; section option attribute. 
These attributes are used for any reason for each 
Communication Proxy.</p>

<p>
<table border>
<tr>
<th> name </th>
<th> mandatory </th>
<th> multiple </th>
<th> meanings </th>
</tr>

<tr>
<td> <a href="#CommunicationProxy_INITIALIZE_client_attribute-listen_port">
    listen_port </a></td>
<td> yes </td>
<td> no </td>
<td> port number of Ninf-G Client </td>
</tr>

<tr>
<td> <a href="#CommunicationProxy_INITIALIZE_client_attribute-buffer_size">
    buffer_size </a></td>
<td> yes </td>
<td> no </td>
<td> buffer size </td>
</tr>
</table>
</p>


<ul>
<li><a name="CommunicationProxy_INITIALIZE_client_attribute-listen_port">
  listen_port [number] </a>

<p>This specifies the port number on which the Ninf-G Client is
listening.</p>

<li><a name="CommunicationProxy_INITIALIZE_client_attribute-buffer_size">
    buffer_size [size] </a>

<p>This specifies the buffer size of Client Communication Proxy.
The units are in bytes.</p>

</ul>

<li>Remote Communication Proxy

<p>Following attributes are passed from Ninf-G Executable.</p>

<p>Any attributes not shown in the following table can be specified by
specifying communication_proxy_option attribute in &lt;SERVER&gt;
section of Ninf-G Client configuration file.
These attributes are used for any reason for each Communication
Proxy.</p>

<p>In addition, Remote Communication Proxy receives any attributes
which is decided by each Communication Proxy for the following purpose.
This attributes may be described by multiple lines.</p>

<p>
<ul>
<li>The information to connect to Client Communication Proxy
<p>This information is generated by
<code>COMMUNICATION_REPLY</code> on Client Communication Proxy.</p>
</ul>
</p>

<p>
<table border>
<tr>
<th> name </th>
<th> mandatory </th>
<th> multiple </th>
<th> meanings </th>
</tr>

<tr>
<td> <a href="#CommunicationProxy_INITIALIZE_remote_attribute-hostname">
    hostname </a></td>
<td> yes </td>
<td> no </td>
<td> hostname of Ninf-G Client </td>
</tr>

<tr>
<td> <a href="#CommunicationProxy_INITIALIZE_remote_attribute-buffer_size">
    buffer_size </a></td>
<td> yes </td>
<td> no </td>
<td> buffer size </td>
</tr>

<tr>
<td> <a href="#CommunicationProxy_INITIALIZE_remote_attribute-tcp_nodelay">
    tcp_nodelay </a></td>
<td> yes </td>
<td> no </td>
<td> TCP_NODELAY </td>
</tr>

<tr>
<td> <a href="#CommunicationProxy_INITIALIZE_remote_attribute-retryCount">
    tcp_connect_retryCount </a></td>
<td> yes </td>
<td> no </td>
<td> retry count </td>
</tr>

<tr>
<td> <a href="#CommunicationProxy_INITIALIZE_remote_attribute-retryInterval">
    tcp_connect_retryBaseInterval </a></td>
<td> yes </td>
<td> no </td>
<td> retry base interval </td>
</tr>

<tr>
<td> <a href="#CommunicationProxy_INITIALIZE_remote_attribute-retryRatio">
    tcp_connect_retryIncreaseRatio </a></td>
<td> yes </td>
<td> no </td>
<td> retry increase ratio </td>
</tr>

<tr>
<td> <a href="#CommunicationProxy_INITIALIZE_remote_attribute-retryRandom">
    tcp_connect_retryRandom </a></td>
<td> yes </td>
<td> no </td>
<td> random retry </td>
</tr>
</table>
</p>


<ul>
<li><a name="CommunicationProxy_INITIALIZE_remote_attribute-hostname">
  hostname [hostname] </a>

<p>This specifies the hostname of Ninf-G Client.</p>

<li><a name="CommunicationProxy_INITIALIZE_remote_attribute-buffer_size">
    buffer_size [size] </a>

<p>This specifies the buffer size of Remote Communication Proxy.
The units are in bytes.</p>

<li><a name="CommunicationProxy_INITIALIZE_remote_attribute-tcp_nodelay">
    tcp_nodelay [true/false] </a>

<p>This specifies whether or not to set TCP_NODELAY.
If the value is true, TCP_NODELAY must be set to all connections to
Remote Communication Proxy.</p>

<p>Note: If the TCP/IP is not used for communication between
Remote Communication Proxy and Client Communication Proxy, the
value is ignored.</p>

<li><a name="CommunicationProxy_INITIALIZE_remote_attribute-retryCount">
    tcp_connect_retryCount [count] </a>

<p>This specifies the maximum number of retries for establishing a
connection.</p>

<li><a name="CommunicationProxy_INITIALIZE_remote_attribute-retryInterval">
    tcp_connect_retryBaseInterval [interval] </a>

<p>This specifies the base interval time for the first retry.
The value is in seconds.
This value is used as the maximum interval time for the first retry.</p>

<li><a name="CommunicationProxy_INITIALIZE_remote_attribute-retryRatio">
    tcp_connect_retryIncreaseRatio [ratio] </a>

<p>This specifies the increase ratio which is used to calculate
the maximum interval time between retries.
The maximum interval time is calculated by multiplying this value
and the maximum interval time for the last retry.
For the first retry, the value of
<code>tcp_connect_retryBaseInterval</code> is used as
the maximum interval time.</p>

<p>The value is greater than 1.0.</p>

<li><a name="CommunicationProxy_INITIALIZE_remote_attribute-retryRandom">
    tcp_connect_retryRandom [true/false] </a>

<p>This specifies a flag that specifies whether a random value
is used or not for the interval time.
If the value is true, the interval time between retries is
set randomly between 0.0 seconds to the maximum interval time.
If the value is false, the maximum interval time is used as the interval
time.</p>

</ul>
</ul>
</ul>

<li><code>PREPARE_COMMUNICATION</code>

<ul>
<li>Format

<p>
<table border>
<tr><td>
<pre><code>
PREPARE_COMMUNICATION&lt;RET&gt;
request_id 1&lt;RET&gt;
tcp_nodelay true&lt;RET&gt;
tcp_connect_retryCount 4&lt;RET&gt;
tcp_connect_retryBaseInterval 4&lt;RET&gt;
tcp_connect_retryIncreaseRatio 2.0&lt;RET&gt;
tcp_connect_retryRandom true&lt;RET&gt;
... (snip) 
PREPARE_COMMUNICATION_END&lt;RET&gt;
</code></pre>
</td></tr>
</table>
</p>

<li>Explanation

<p>This request is used to command the Client Communication Proxy 
to prepare communication for Remote Communication Proxy, 
when a function handle is creating. 
This request is issued before the job invocation request for 
Invoke Server. To prepare communication, it will take time. 
Thus, report to Ninf-G Client that the communication is 
ready, is told not by reply, but of a
<code>COMMUNICATION_REPLY</code> notify. 
This request is only issued to Client Communication Proxy. 
This request is a multiple line type request.</p>

<p>Following attributes are passed from Ninf-G Client.</p>

<p>Any attributes not shown in the following table can be specified by
specifying Ninf-G Client configuration file &lt;SERVER&gt; section
communication_proxy_option attribute. These attributes are used for
any reason for each Communication Proxy.</p>

<p>
<table border>
<tr>
<th> name </th>
<th> mandatory </th>
<th> multiple </th>
<th> meanings </th>
</tr>

<tr>
<td> <a href="#CommunicationProxy_PREPARECOMM_attribute-request_id">
    request_id </a></td>
<td> yes </td>
<td> no </td>
<td> Request ID </td>
</tr>

<tr>
<td> <a href="#CommunicationProxy_PREPARECOMM_attribute-tcp_nodelay">
    tcp_nodelay </a></td>
<td> yes </td>
<td> no </td>
<td> TCP_NODELAY </td>
</tr>

<tr>
<td> <a href="#CommunicationProxy_PREPARECOMM_attribute-retryCount">
    tcp_connect_retryCount </a></td>
<td> yes </td>
<td> no </td>
<td> retry count </td>
</tr>

<tr>
<td> <a href="#CommunicationProxy_PREPARECOMM_attribute-retryInterval">
    tcp_connect_retryBaseInterval </a></td>
<td> yes </td>
<td> no </td>
<td> retry base interval </td>
</tr>

<tr>
<td> <a href="#CommunicationProxy_PREPARECOMM_attribute-retryRatio">
    tcp_connect_retryIncreaseRatio </a></td>
<td> yes </td>
<td> no </td>
<td> retry increase ratio </td>
</tr>

<tr>
<td> <a href="#CommunicationProxy_PREPARECOMM_attribute-retryRandom">
    tcp_connect_retryRandom </a></td>
<td> yes </td>
<td> no </td>
<td> random retry </td>
</tr>
</table>
</p>


<ul>
<li><a name="CommunicationProxy_PREPARECOMM_attribute-request_id">
  request_id [id] </a>

<p>This specifies the ID to identify the request.
This ID is used by the <code>COMMUNICATION_REPLY</code> notify,
when the communication become ready.</p>

<li><a name="CommunicationProxy_PREPARECOMM_attribute-tcp_nodelay">
    tcp_nodelay [true/false] </a>

<p>This specifies whether or not to set TCP_NODELAY.
If the value is true, TCP_NODELAY must be set to connections
related to this request on the Client Communication Proxy.</p>

<p>Note: If the TCP/IP is not used for communication between
Remote Communication Proxy and Client Communication Proxy, the
value is ignored.</p>

<li><a name="CommunicationProxy_PREPARECOMM_attribute-retryCount">
    tcp_connect_retryCount [count] </a>

<p>This specifies the maximum number of retries for establishing a
connection.</p>

<li><a name="CommunicationProxy_PREPARECOMM_attribute-retryInterval">
    tcp_connect_retryBaseInterval [interval] </a>

<p>This specifies the base interval time for the first retry.
The value is in seconds.
This value is used as the maximum interval time for the first retry.</p>

<li><a name="CommunicationProxy_PREPARECOMM_attribute-retryRatio">
    tcp_connect_retryIncreaseRatio [ratio] </a>

<p>This specifies the increase ratio which is used to calculate
the maximum interval time between retries.
The maximum interval time is calculated by multiplying this value
and the maximum interval time for the last retry.
For the first retry, the value of
<code>tcp_connect_retryBaseInterval</code> is used as
the maximum interval time.</p>

<p>The value is greater than 1.0.</p>

<li><a name="CommunicationProxy_PREPARECOMM_attribute-retryRandom">
    tcp_connect_retryRandom [true/false] </a>

<p>This specifies a flag that specifies whether a random value
is used or not for the interval time.
If the value is true, the interval time between retries is
set randomly between 0.0 seconds to the maximum interval time.
If the value is false, the maximum interval time is used as the interval
time.</p>

</ul>
</ul>

<li><code>EXIT</code>

<ul>
<li>Format

<p>
<table border>
<tr><td>
<pre><code>
EXIT&lt;RET&gt;
</code></pre>
</td></tr>
</table>
</p>

<li>Explanation

<p>This request is used to exit the Communication Proxy.
This request is a one line type request and have no parameter.</p>
</ul>
</ol>


<h6><a name="CommunicationProxy_Protocol_Reply">
4.2.2.3 Reply</a></h6>

<p>Communication Proxy must send a Reply message to a Ninf-G Client 
(Ninf-G Executable) if Communication Proxy receives a 
Request message from that Ninf-G Client (Ninf-G Executable).</p>

<ul>
<li><code>INITIALIZE</code>

<ul>
<li>Client Communication Proxy

<p>The reply to <code>INITIALIZE</code> messages is:</p>

<p>
<table border>
<tr><td>
<pre><code>
[S   | F &lt;Error String&gt;]&lt;RET&gt;
</code></pre>
</td></tr>
</table>
</p>

<p>where <code>S</code> is sent in case of Success.
Otherwise, <code>F</code> is returned, followed by
&lt;Error String&gt;.</p>

<li>Remote Communication Proxy

<p>The reply to <code>INITIALIZE</code> messages is:</p>

<p>
<table border>
<tr><td>
<pre><code>
SM&lt;RET&gt;
address [address-string]&lt;RET&gt;
REPLY_END&lt;RET&gt;
</code></pre>
</td></tr>
</table>
</p>
</ul>

<p>where <code>SM</code> is sent in case of Success.
Otherwise, <code>F</code> is returned, followed by
&lt;Error String&gt;.</p>

<p><code>[address-string]</code> is the address, which the Ninf-G
Executable must connect to.
This address is TCP or the local socket address. 
This address may not be Remote Communication Proxy.</p>

<p>The address form is as follows:</p>
 
<ul>
<li>TCP 
<pre><code>
ng_tcp://[hostname]:[port-number] 
</code></pre>

<p>Ninf-G Executable must connect to the hostname of
<code>[hostname]</code>, and the port number of
<code>[port-number]</code> by TCP.</p>
 
<li>local socket 
<pre><code>
ng_local://[path-to-local-socket] 
</code></pre>

<p>Ninf-G Executable must connect to the
<code>[path-to-local-socket]</code>
by local socket (UNIX domain socket).</p>
</ul>

<li><code>PREPARE_COMMUNICATION</code>, <code>EXIT</code>

<p>The reply to 
<code>PREPARE_COMMUNICATION</code> and <code>EXIT</code>
messages is:</p>

<p>
<table border>
<tr><td>
<pre><code>
[S   | F &lt;Error String&gt;]&lt;RET&gt;
</code></pre>
</td></tr>
</table>
</p>

<p>where <code>S</code> is sent in case of Success.
Otherwise, <code>F</code> is returned, followed by
&lt;Error String&gt;.</p>


<li><code>QUERY_FEATURES</code>

<p>The reply to a <code>QUERY_FEATURES</code> request is
described in <a href="#ExternalModule_protocol_reply"> 2.2.3</a>.
Ninf-G Version 5.0.0 Communication Proxy has protocol version 1.0.</p>

<p>Communication Proxy have no extended features.</p>
</ul>


<h6><a name="CommunicationProxy_Protocol_Notify">
4.2.2.4 Notify</a></h6>

<p>A Notify message is used to send an asynchronous message from 
Communication Proxy to a Ninf-G Client. 
One type of Notify message is provided.</p>

<ol>
<li><code>COMMUNICATION_REPLY</code>

<ul>
<li>Format

<p>
<table border>
<tr><td>
<pre><code>
COMMUNICATION_REPLY&lt;RET&gt;
request_id 1&lt;RET&gt;
result [S | F]&lt;RET&gt;
... (snip)
COMMUNICATION_REPLY_END&lt;RET&gt;
</code></pre>
</td></tr>
</table>
</p>

<li>Explanation

<p>This Notify tells the Ninf-G Client that the preparation, 
which was requested by <code>PREPARE_COMMUNICATION</code> Request,
has been completed.
This Notify is only used on Client Communication Proxy. 
This Notify is a multiple line type Notify.</p>

<p>Following attributes are passed from Client Communication Proxy.</p>

<p>Any attributes not shown in the following table can be passed, 
for the following purpose.</p>

<ul>
<li>The information to connect to Client Communication Proxy 

<p>This information is used by Remote Communication Proxy 
to connect to Client Communication Proxy. 
This information is first passed to Ninf-G Client, 
then Ninf-G Executable, and finally passed to 
Remote Communication Proxy. 
Multiple attributes can be passed. If the preparation of 
communication failed, this attributes cannot be passed.</p>
</ul>

<p>
<table border>
<tr>
<th> name </th>
<th> mandatory </th>
<th> multiple </th>
<th> meanings </th>
</tr>

<tr>
<td><a href="#CommunicationProxy_COMMREPLY_attribute-request_id">
    request_id </a></td>
<td> yes </td>
<td> no </td>
<td> Request ID </td>
</tr>

<tr>
<td><a href="#CommunicationProxy_COMMREPLY_attribute-result">
    result </a></td>
<td> yes </td>
<td> no </td>
<td> result </td>
</tr>

<tr>
<td><a href="#CommunicationProxy_COMMREPLY_attribute-message">
    message </a></td>
<td> no </td>
<td> no </td>
<td> message </td>
</tr>
</table>
</p>

<ul>
<li><a name="CommunicationProxy_COMMREPLY_attribute-request_id">
    request_id [id] </a>

<p>This specifies the Request ID passed by
<code>PREPARE_COMMUNICATION</code> Request.</p>

<li><a name="CommunicationProxy_COMMREPLY_attribute-result">
    result [S|F] </a>

<p>This specifies the preparation of communication was successful
or not. <code>S</code> is returned on success, <code>F</code>
is returned on failure.</p>

<li><a name="CommunicationProxy_COMMREPLY_attribute-message">
    message [error message] </a>

<p>This specifies the error cause message.
This attribute is only specified on failure case.</p>
</ul>
</ul>
</ol>

<h3><a name="InformationService">
5. Information Service</a></h3>

<h4><a name="InformationService_Introduction">
5.1 Introduction</a></h4>

<p>Information Service searches and retrieves the Ninf-G Executable 
information. 
Ninf-G Executable information is required when a function handle is 
creating. Information Service is a External Module, which enable to 
search and retrieve Ninf-G Executable information, without depending 
on specific Grid Middleware.</p>
 
<p>Ninf-G Version 5.0.0 includes the following Information Service:</p>
 
<ul>
<li>Information Service for NRF, implemented in C (NRF) 
<li>Information Service for Globus Toolkit WS MDS, implemented in Java (MDS4) 
</ul>

<h4><a name="InformationService_Specification">
5.2 Specification of Information Service</a></h4>

<h5><a name="InformationService_Details">
5.2.1 Details of Information Service</a></h5>

<ul>
<li><p>Information Service is invoked when a Ninf-G Client
searches a Ninf-G Executable information
for new function/object handle.</p>

<li><p>Ninf-G Client wait for the termination of
Information Service after the Ninf-G Client sends an EXIT request
to Information Service.</p>

<li><p>The file names used with Information Service must follow the naming
convention of "ng_information_service" + suffix,
where the suffix corresponds to rules for the underlying middleware
used for information query.</p>
</ul>

<h5><a name="InformationService_Protocol">
5.2.2 Protocol between a Ninf-G Client (Ninf-G Executable) and
    Information Service</a></h5>

<h6><a name="InformationService_Protocol_Overview">
5.2.2.1 Overview</a></h6>

<p>A common feature of External Module protocol is described in
<a href="#ExternalModule_protocol">Section 2.2</a>.
A protocol specific to Information Service is described
in the following sections.</p>

<h6><a name="InformationService_Protocol_Request">
5.2.2.2 Request</a></h6>

<p>Four Request messages,
<code>QUERY_REMOTE_EXECUTABLE_INFORMATION</code>,
<code>CANCEL_QUERY</code>, 
<code>EXIT</code> and <code>QUERY_FEATURES</code> are supported.</p>

<ol>
<li>QUERY_REMOTE_EXECUTABLE_INFORMATION

<ul>
<li>Format

<p>
<table border>
<tr><td>
<pre><code>
QUERY_REMOTE_EXECUTABLE_INFORMATION&lt;RET&gt;
hostname ...&lt;RET&gt;
classname ...&lt;RET&gt;
source ...&lt;RET&gt;
... (snip) 
QUERY_REMOTE_EXECUTABLE_INFORMATION_END&lt;RET&gt;
</code></pre>
</td></tr>
</table>
</p>

<li>Explanation

<p>This Request is used to query the Ninf-G Executable information. 
The searched information is returned to Ninf-G Client by 
<code>REMOTE_EXECUTABLE_INFORMATION_NOTIFY</code> Notify.
This Request is a multi line type Request.</p>

<p>Following attributes are passed from Ninf-G Client.</p>

<p>Any attributes not shown in the following table can be specified by
specifying Ninf-G Client configuration file
&lt;INFORMATION_SOURCE&gt; section option attribute. These
attributes are used for any reason for each Information Service.</p>

<p>
<table border>
<tr>
<th> name </th>
<th> mandatory </th>
<th> multiple </th>
<th> meanings </th>
</tr>

<tr>
<td> <a href="#InformationService_QUERY_attribute-hostname">
    hostname </a></td>
<td> yes </td>
<td> no </td>
<td> hostname </td>
</tr>

<tr>
<td> <a href="#InformationService_QUERY_attribute-classname">
    classname </a></td>
<td> yes </td>
<td> no </td>
<td> classname </td>
</tr>

<tr>
<td> <a href="#InformationService_QUERY_attribute-source">
    source </a></td>
<td> yes </td>
<td> yes </td>
<td> source </td>
</tr>
</table>
</p>

<ul>
<li><a name="InformationService_QUERY_attribute-hostname">
    hostname [hostname] </a>

<p>This specifies the hostname of query target.</p>

<li><a name="InformationService_QUERY_attribute-classname">
    classname [classname] </a>

<p>This specifies the classname of query target.</p>

<li><a name="InformationService_QUERY_attribute-source">
    source [source string] </a>

<p>This specifies the source of Ninf-G Executable information.
The meaning and expression of source can be defined by respective 
Information Service. 
The Information Service must search the information from the
specified sources.
This attribute can specify one source only, and multiple
sources can be specified one by one.</p>
</ul>
</ul>

<li>CANCEL_QUERY

<ul>
<li>Format

<p>
<table border>
<tr><td>
<pre><code>
CANCEL_QUERY &lt;Query ID&gt;&lt;RET&gt;
</code></pre>
</td></tr>
</table>
</p>

<li>Explanation

<p>This request is used to cancel the ongoing query of the 
Ninf-G Executable information. 
The argument <code>&lt;Query ID&gt;</code> is the ID issued by 
QUERY_REMOTE_EXECUTABLE_INFORMATION Reply.
This Request is a one line type Request.</p>
</ul>

<li>EXIT

<ul>
<li>Format

<p>
<table border>
<tr><td>
<pre><code>
EXIT&lt;RET&gt;
</code></pre>
</td></tr>
</table>
</p>

<li>Explanation

<p>This request is used to exit the Information Service.
This request is a one line type request and have no parameter.</p>
</ul>
</ol>

<h6><a name="InformationService_Protocol_Reply">
5.2.2.3 Reply</a></h6>

<p>Information Service must send a Reply message to a Ninf-G Client
if Information Service receives a Request message from that Ninf-G Client.</p>

<ul>
<li><code>QUERY_REMOTE_EXECUTABLE_INFORMATION</code>

<p>The reply to <code>QUERY_REMOTE_EXECUTABLE_INFORMATION</code>
messages is:</p>

<p>
<table border>
<tr><td>
<pre><code>
[S &lt;Query ID&gt;  | F &lt;Error String&gt;]&lt;RET&gt;
</code></pre>
</td></tr>
</table>
</p>

<p>where <code>S</code> is sent in case of Success.
Otherwise, <code>F</code> is returned, followed by
&lt;Error String&gt;.</p>

<p>Query ID is the ID to identify the query.
A Query ID is case sensitive and cannot include invisible
characters.</p>

<li><code>CANCEL_QUERY</code>, <code>EXIT</code>

<p>The reply to <code>CANCEL_QUERY</code>
and <code>EXIT</code> messages is:</p>

<p>
<table border>
<tr><td>
<pre><code>
[S   | F &lt;Error String&gt;]&lt;RET&gt;
</code></pre>
</td></tr>
</table>
</p>

<p>where <code>S</code> is sent in case of Success.
Otherwise, <code>F</code> is returned, followed by
&lt;Error String&gt;.</p>


<li><code>QUERY_FEATURES</code>

<p>The reply to a <code>QUERY_FEATURES</code> request is
described in <a href="#ExternalModule_protocol_reply"> 2.2.3</a>.
Ninf-G Version 5.0.0 Information Service has protocol version 1.0.</p>

<p>Information Service have no extended features.</p>
</ul>

<h6><a name="InformationService_Protocol_Notify">
5.2.2.4 Notify</a></h6>

<p>A Notify message is used to send an asynchronous message from 
Information Service to a Ninf-G Client. One type of Notify 
message are provided.</p>

<ol>
<li>REMOTE_EXECUTABLE_INFORMATION_NOTIFY

<ul>
<li>Format
<p>
<table border>
<tr><td>
<pre><code>
REMOTE_EXECUTABLE_INFORMATION_NOTIFY&lt;RET&gt;
query_id ...&lt;RET&gt;
result [S | F]&lt;RET&gt;
remote_executable_information &lt;?xml version="1.0" encoding="utf-8 ?&gt;&lt;RET&gt;
remote_executable_information &lt;RemoteExecutableInformation&gt;&lt;RET&gt;
remote_executable_information &lt;hostName&gt;...&lt;/hostName&gt;&lt;RET&gt;
... (snip) 
remote_executable_information     &lt;/class&gt;&lt;RET&gt;
remote_executable_information &lt;/RemoteExecutableInformation&gt;&lt;RET&gt;
REMOTE_EXECUTABLE_INFORMATION_NOTIFY_END&lt;RET&gt;
</code></pre>
</td></tr>
</table>
</p>

<li>Explanation

<p>This Notify is used to return the information, queried 
in advance from the Ninf-G Client. The returned query result is 
success or failure, and if the result is success, 
XML form of information is returned. 
This Notify is a multi line type Notify.</p>

<p>The XML information, that must be returned to Ninf-G Client 
is as follows:</p>

<ul>
<li>The returned information is Remote Executable Information. 

<li>Following namespaces must be defined. 
<pre><code>
rei=http://ninf.apgrid.org/2006/12/NinfGRemoteInformation
rci=http://ninf.apgrid.org/2006/12/RemoteClassInformation 
</code></pre>

<li>Remote Executable Information is expressed as XML document. 
  root element is
<code>&lt;rei:RemoteExecutableInformation&gt;</code>. 

<li><code>&lt;rei:hostName&gt;</code> text in
<code>&lt;rei:RemoteExecutableInformation&gt;</code> 
must be hostname of specified query target. 

<li>
<code>"name"</code> attribute of <code>&lt;rci:class&gt;</code> in 

<code>&lt;rei:RemoteExecutableInformation&gt;</code>
must be classname of specified query target. 
</ul>

<p>This XML document is written in NRF file, which is generated 
when the Ninf-G Executable is compiled.</p>

<p>Following attributes are passed from Information Service.</p>

<p>
<table border>
<tr>
<th> name </th>
<th> mandatory </th>
<th> multiple </th>
<th> meanings </th>
</tr>

<tr>
<td> <a href="#InformationService_NOTIFY_attribute-query_id">
    query_id </a></td>
<td> yes </td>
<td> no </td>
<td> Query ID </td>
</tr>

<tr>
<td> <a href="#InformationService_NOTIFY_attribute-result">
    result </a></td>
<td> yes </td>
<td> no </td>
<td> Query result </td>
</tr>

<tr>
<td> <a href="#InformationService_NOTIFY_attribute-information">
    remote_executable_information </a></td>
<td> no </td>
<td> yes </td>
<td> information </td>
</tr>

<tr>
<td> <a href="#InformationService_NOTIFY_attribute-error_message">
    error_message </a></td>
<td> no </td>
<td> no </td>
<td> error message </td>
</tr>
</table>
</p>

<ul>
<li><a name="InformationService_NOTIFY_attribute-query_id">
  query_id [id] </a>

<p>This specifies the query ID, which is generated by
QUERY_REMOTE_EXECUTABLE_INFORMATION Reply.</p>

<li><a name="InformationService_NOTIFY_attribute-result">
  result [S|F] </a>

<p>This specifies the result of the query.
If the query is successful, <code>S</code> is returned,
otherwise, <code>F</code> is returned.</p>

<li><a name="InformationService_NOTIFY_attribute-information">
  remote_executable_information [string] </a>

<p>This specifies the Remote Executable Information.
This information is XML document, which have multiple lines.
This attribute can specify one line of XML document only,
and multiple lines must be specified one by one, by using
this attribute for each one.
The attribute value cannot include a return character code.</p>

<p>This attribute is only specified if the query is successful.</p>

<li><a name="InformationService_NOTIFY_attribute-error_message">
  error_message [message] </a>

<p>This specifies the error message, when the query fail.</p>

<p>This attribute is only specified if the query fail.</p>

</ul>

</ul>
</ol>

<hr>
last update : $Date: 2008/03/28 02:18:25 $
</body>
</html>

